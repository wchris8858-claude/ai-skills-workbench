# AI 选片修片功能修复说明

## 问题描述

用户报告 "AI选片修片" 技能显示错误消息：
```
抱歉,处理请求时出现错误。请稍后重试。
```

## 根本原因

`photo-selector` 技能在 `lib/claude/client.ts` 中**缺少系统提示词(system prompt)**。

当 AI API 收到请求时,找不到对应的提示词,导致:
1. `getSkillSystemPrompt('photo-selector')` 返回默认提示词
2. 或者在某些情况下导致API调用失败
3. 最终显示通用错误消息

## 解决方案

已在 [lib/claude/client.ts:164-180](lib/claude/client.ts#L164-L180) 添加完整的 `photo-selector` 系统提示词:

```typescript
'photo-selector': `你是一个专业的摄影师和修图师，擅长选片和提供修图建议。

评估标准：
1. 构图质量：画面平衡、主体突出、视觉引导
2. 光影效果：曝光准确、明暗对比、光线运用
3. 色彩表现：色调和谐、饱和度适中、色彩情绪
4. 清晰度：焦点清晰、画面锐度
5. 创意表达：视角独特、情感传递、故事性

分析要求：
1. 对每张照片进行专业评分（1-10分）
2. 指出照片的优点和不足
3. 推荐最佳照片（评分最高的）
4. 为每张照片提供具体的修图建议
5. 包括构图、色调、光影等方面的优化方向

请分析用户上传的照片，提供专业的选片和修图建议。`
```

## 测试步骤

1. **重启开发服务器** (已完成)
   ```bash
   # 停止旧服务器
   lsof -ti:3000 | xargs kill -9

   # 启动新服务器
   npm run dev
   ```

2. **打开 AI 选片修片页面**
   - 访问: http://localhost:3000/skill/photo-selector
   - 或从技能广场点击 "AI 选片修片"

3. **上传测试图片**
   - 点击图片上传按钮
   - 选择 1-3 张照片
   - 发送消息,例如: "请帮我分析这些照片"

4. **验证功能正常**
   - ✅ 应该看到 AI 开始分析照片
   - ✅ 应该返回每张照片的评分和建议
   - ✅ 不应该再看到错误消息

## 预期输出示例

AI 应该返回类似这样的分析:

```
照片 1 分析：
评分: 8/10

优点:
- 构图平衡,主体突出
- 光线柔和,明暗过渡自然
- 色彩和谐

不足:
- 背景略显杂乱
- 对比度可以提升

修图建议:
1. 裁剪优化构图,突出主体
2. 适当提升对比度和清晰度
3. 调整色温使画面更温暖
...
```

## 修改的文件

- [lib/claude/client.ts](lib/claude/client.ts) - 添加 photo-selector 系统提示词

## 注意事项

- 开发服务器已重启,代码更改已生效
- 如果仍看到旧错误消息,请**硬刷新浏览器** (Ctrl+Shift+R 或 Cmd+Shift+R)
- 清除浏览器缓存可能有帮助
