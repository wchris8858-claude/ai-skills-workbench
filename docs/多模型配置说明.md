# AI Skills Workbench 多模型配置说明

## 概述

本项目采用多模型架构，根据不同技能的特点，选择最合适的 AI 模型提供服务。

## 技能与模型映射

| 技能名称 | 文本模型 | 图像模型 | 语音模型 | 说明 |
|---------|---------|---------|---------|------|
| 朋友圈文案 | Claude 3.5 Sonnet | - | 讯飞语音听写 | 创意性文案，Claude 表现最佳 |
| 视频文案改写 | Claude 3.5 Sonnet | - | 讯飞语音听写 | 内容改写，保持准确性 |
| 爆款拆解 | Claude 3.5 Sonnet | - | - | 深度分析，需要强推理能力 |
| 会议语音转文字 | 豆包 Pro | - | 讯飞实时转写 | 中文处理优秀 |
| 知识库查询 | 豆包 Pro | - | 讯飞语音听写 | 快速响应，中文友好 |
| 官方通知 | 通义千问 Max | - | - | 正式文体，中文表达严谨 |
| 海报制作 | Gemini 2.0 Flash | 即梦 2.1 Pro | - | 创意设计+图像生成 |
| AI 选片修片 | 豆包 Pro | 即梦 2.1 Pro | - | 图像分析+图像生成 |

## 模型提供商

### 1. Anthropic (Claude)

**使用场景**: 文案创作、内容分析

**优势**:
- 强大的中文理解和生成能力
- 出色的创意性和表达能力
- 适合需要高质量文案的场景

**配置**:
```env
ANTHROPIC_API_KEY=your_key
```

### 2. ByteDance (豆包)

**使用场景**: 会议记录、知识查询、图片分析

**优势**:
- 中文处理能力强
- 响应速度快
- 性价比高

**配置**:
```env
BYTEDANCE_API_KEY=your_key
BYTEDANCE_ENDPOINT=https://ark.cn-beijing.volces.com/api/v3
```

### 3. Alibaba (通义千问)

**使用场景**: 官方通知、正式文体

**优势**:
- 中文表达严谨
- 适合正式场合
- 符合国内用词习惯

**配置**:
```env
ALIBABA_API_KEY=your_key
ALIBABA_ENDPOINT=https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation
```

### 4. Google (Gemini)

**使用场景**: 创意设计、头脑风暴

**优势**:
- 创意思维发散
- 多模态能力
- 适合设计类任务

**配置**:
```env
GOOGLE_API_KEY=your_key
GOOGLE_ENDPOINT=https://generativelanguage.googleapis.com/v1beta
```

### 5. 即梦 (Jimeng)

**使用场景**: 图像生成

**优势**:
- 中文提示词理解好
- 图像质量高
- 适合国内场景

**配置**:
```env
JIMENG_API_KEY=your_key
JIMENG_ENDPOINT=https://api.jimeng.ai/v1
```

### 6. 讯飞 (iFlytek)

**使用场景**: 语音识别

**优势**:
- 中文语音识别准确
- 支持实时转写
- 方言识别能力强

**配置**:
```env
IFLYTEK_APP_ID=your_app_id
IFLYTEK_API_KEY=your_key
```

## 技术架构

### 调度器 (Dispatcher)

位置: `lib/ai/dispatcher.ts`

功能:
- 根据技能 ID 自动选择合适的模型
- 统一的请求接口
- 自动处理不同模型的 API 格式差异

### 模型配置

位置: `lib/models/config.ts`

包含:
- 所有可用模型的定义
- 技能与模型的映射关系
- 模型参数配置（温度、最大 tokens 等）

### API 客户端

位置: `lib/ai/`

各模型的独立客户端:
- `bytedance.ts` - 豆包客户端
- `alibaba.ts` - 通义千问客户端
- `google.ts` - Gemini 客户端
- `jimeng.ts` - 即梦客户端
- `dispatcher.ts` - 统一调度器

## 使用方法

### 1. 配置环境变量

复制 `.env.example` 到 `.env.local`:

```bash
cp .env.example .env.local
```

然后填入你的 API 密钥。

### 2. 调用示例

```typescript
import { dispatchAI } from '@/lib/ai/dispatcher'

// 自动根据技能选择模型
const response = await dispatchAI({
  skillId: 'moments-copywriter', // 会使用 Claude
  message: '今天天气真好',
  systemPrompt: '你是朋友圈文案专家',
})

console.log(response.content) // AI 生成的内容
console.log(response.provider) // 使用的模型提供商
console.log(response.model) // 使用的具体模型
```

### 3. 添加新技能

在 `lib/models/config.ts` 中添加配置:

```typescript
export const SKILL_MODEL_CONFIG: Record<string, SkillModelMapping> = {
  // ... 现有配置

  'your-new-skill': {
    text: {
      ...AVAILABLE_MODELS.bytedance['doubao-pro'],
      temperature: 0.7,
    },
    image: AVAILABLE_MODELS.jimeng['jimeng-2.1'],
  },
}
```

## 性能优化

1. **模型选择**: 根据任务特点选择最合适的模型
2. **参数调优**: 不同任务使用不同的温度和 max_tokens
3. **降级策略**: API 失败时自动返回 Mock 响应
4. **缓存**: 未来可添加响应缓存

## 成本控制

- Claude: 用于需要最高质量的创作任务
- 豆包/通义千问: 用于日常对话和查询
- Gemini: 用于创意设计
- 即梦: 仅在需要图像生成时使用

## 监控与日志

所有 AI 调用都会记录:
- 使用的模型
- Token 消耗
- 响应时间
- 错误信息

查看位置: `lib/db/stats.ts`

## 故障排查

### 1. API 密钥未配置

错误: `XXX_API_KEY is not configured`

解决: 在 `.env.local` 中配置相应的 API 密钥

### 2. API 调用失败

错误: `API error: 401/403`

解决: 检查 API 密钥是否正确，是否有足够的额度

### 3. 返回 Mock 响应

原因: API 密钥未配置或调用失败

解决: 配置正确的 API 密钥即可获得真实响应

## 未来计划

- [ ] 添加更多模型支持
- [ ] 实现模型 A/B 测试
- [ ] 添加响应缓存
- [ ] 实现成本分析仪表板
- [ ] 支持用户自定义模型配置
