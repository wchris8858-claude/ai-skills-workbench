# AI 掌柜 - 产品需求文档

> 产品名称：AI 掌柜  
> 产品定位：小规模实体店 AI 运营助手  
> 版本：v2.0.0  
> 更新日期：2025-12-30

---

## 目录

1. [项目概述](#1-项目概述)
2. [目标用户](#2-目标用户)
3. [产品架构](#3-产品架构)
4. [功能详细设计](#4-功能详细设计)
5. [通用能力设计](#5-通用能力设计)
6. [技术架构](#6-技术架构)
7. [AI 能力设计](#7-ai-能力设计)
8. [数据库设计](#8-数据库设计)
9. [API 设计](#9-api-设计)
10. [版本规划](#10-版本规划)
11. [附录](#11-附录)

---

## 1. 项目概述

### 1.1 项目简介

**AI 掌柜**是一款面向小规模实体门店的一站式 AI 运营工具平台。借助 AI 大模型能力，帮助店主和运营人员高效完成**公域获客、私域转化、团队管理**三大核心业务场景。

**产品 Slogan**：让每个小店老板都有一个 AI 运营搭档

### 1.2 核心价值主张

| 价值点 | 描述 |
|--------|------|
| **降低门槛** | 无需 AI 提示词知识，选择功能即可使用 |
| **场景化** | 围绕实体店运营场景设计，开箱即用 |
| **多模态** | 支持文字、语音、图片、链接多种输入方式 |
| **知识驱动** | 品牌知识库作为全局上下文，生成内容更精准 |
| **团队协作** | 支持多账号、多店铺、权限分级管理 |

### 1.3 产品定位

```
目标市场：小规模实体门店（1-10人团队）
核心行业：健身/瑜伽、美容/美发、餐饮/轻食、教培/兴趣班、零售/服装/母婴
核心用户：店主、运营人员、一线员工
使用场景：公域内容生产 → 私域转化运营 → 知识沉淀培训
```

### 1.4 技术栈

```
前端: Next.js 14 (App Router) + React 18 + TypeScript + Tailwind CSS
后端: Next.js API Routes + Supabase (PostgreSQL)
AI:   Claude (Anthropic) + SiliconFlow + 通义万相 + 即梦
部署: Vercel
客户端: iOS App + 微信小程序 + Web 响应式
```

---

## 2. 目标用户

### 2.1 用户画像

| 角色 | 描述 | 核心诉求 | 典型场景 |
|------|------|----------|----------|
| **店主/老板** | 小规模门店经营者，1-10人团队 | 省时省力、管好团队、提升业绩 | 审核内容、查看数据、制定策略 |
| **运营人员** | 负责线上推广和私域运营 | 快速产出内容、提升转化率 | 发朋友圈、做活动、写文案 |
| **一线员工** | 教练、服务员、销售等 | 快速学习、应对客户问题 | 查话术、学知识、练沟通 |

### 2.2 用户能力分层

| 层级 | 特征 | 产品策略 |
|------|------|----------|
| **小白用户** | 完全不会写，需要 AI 全自动生成 | 提供模板、一键生成、最少输入 |
| **进阶用户** | 有基本想法，需要 AI 帮忙润色 | 支持追加指令、局部重写、风格调整 |

### 2.3 用户旅程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              用户完整旅程                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  [新用户注册]                                                                │
│       │                                                                     │
│       ▼                                                                     │
│  ┌─────────────┐                                                           │
│  │ 店铺档案设置 │  ← 首次必填：店铺名称、行业、主营业务                        │
│  └──────┬──────┘                                                           │
│         │                                                                   │
│         ▼                                                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                          首页（模块入口）                             │   │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐           │   │
│  │  │  自媒体工具库  │  │  私域运营助理  │  │  品牌知识库   │           │   │
│  │  └───────┬───────┘  └───────┬───────┘  └───────┬───────┘           │   │
│  └──────────┼──────────────────┼──────────────────┼─────────────────────┘   │
│             │                  │                  │                         │
│             ▼                  ▼                  ▼                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                          功能使用界面                                │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │  输入区域                                                    │   │   │
│  │  │  - 文字输入                                                  │   │   │
│  │  │  - 图片上传（支持多图，自动压缩）                             │   │   │
│  │  │  - 语音输入（实时转文字）                                    │   │   │
│  │  │  - 文件上传（Word/PDF/Excel）                               │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                              │                                      │   │
│  │                              ▼                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │  AI 响应区域                                                 │   │   │
│  │  │  - 多版本输出（3-5 个选择）                                  │   │   │
│  │  │  - 质量评分 + 优化建议                                       │   │   │
│  │  │  - 违禁词检测提示                                            │   │   │
│  │  │  - 在线编辑 / 局部重写 / 追加指令                            │   │   │
│  │  │  - 一键复制 / 收藏 / 跨功能流转                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│             ┌──────────────────────┼──────────────────────┐                │
│             ▼                      ▼                      ▼                │
│      ┌───────────┐          ┌───────────┐          ┌───────────┐          │
│      │ 内容日历   │          │ 素材库    │          │ 历史记录   │          │
│      └───────────┘          └───────────┘          └───────────┘          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 产品架构

### 3.1 模块总览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              AI 掌柜                                         │
│                      「小规模实体店 AI 运营助手」                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐          │
│   │   自媒体工具库   │   │   私域运营助理   │   │   品牌知识库    │          │
│   │   ─────────────  │   │   ─────────────  │   │   ─────────────  │          │
│   │   公域获客       │   │   私域转化       │   │   知识沉淀       │          │
│   ├─────────────────┤   ├─────────────────┤   ├─────────────────┤          │
│   │ • 短视频脚本生成 │   │ • 朋友圈助手     │   │ • 知识库管理     │          │
│   │ • 小红书笔记生成 │   │ • 内容日历       │   │ • 智能问答       │          │
│   │ • 爆款拆解       │   │ • 活动策划       │   │ • 新员工训练村   │          │
│   │ • 文案改写       │   │ • 海报制作       │   │ • AI 模拟对练    │          │
│   │                 │   │ • 运营数据分析   │   │ • 考核测试       │          │
│   └────────┬────────┘   └────────┬────────┘   └────────┬────────┘          │
│            │                     │                     │                    │
│            └─────────────────────┼─────────────────────┘                    │
│                                  │                                          │
│                                  ▼                                          │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                         通用能力层                                   │  │
│   │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │  │
│   │  │ 店铺档案  │ │ 素材库   │ │ 历史记录  │ │ 收藏夹   │ │ 团队权限  │  │  │
│   │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘  │  │
│   │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐              │  │
│   │  │跨功能流转│ │ 版本对比  │ │违禁词检测│ │ 质量评分  │              │  │
│   │  └──────────┘ └──────────┘ └──────────┘ └──────────┘              │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                  │                                          │
│                                  ▼                                          │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                         AI 调度层                                    │  │
│   │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐       │  │
│   │  │ Claude API │ │ SiliconFlow│ │ 通义万相   │ │ 即梦绘图   │       │  │
│   │  └────────────┘ └────────────┘ └────────────┘ └────────────┘       │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 功能清单

| 模块 | 功能 | 优先级 | 阶段 | 描述 |
|------|------|--------|------|------|
| **自媒体工具库** | 短视频脚本生成 | P0 | 一期 | 口播/混剪/情景剧本 |
| | 小红书笔记生成 | P0 | 一期 | 图文笔记+标题优化 |
| | 爆款拆解 | P0 | 一期 | 结构分析+模板提取+一键仿写 |
| | 文案改写 | P0 | 一期 | 去重/风格转换/本地化/违禁词 |
| **私域运营助理** | 朋友圈助手 | P0 | 一期 | 多场景多风格文案生成 |
| | 内容日历 | P1 | 二期 | 多渠道排期+状态管理 |
| | 活动策划 | P1 | 二期 | 方案生成+话术包+复盘 |
| | 海报制作 | P0 | 一期 | 提示词确认+AI生图 |
| | 运营数据分析 | P1 | 二期 | 报表/趋势/诊断/归因 |
| **品牌知识库** | 知识库管理 | P1 | 二期 | 上传/生成/版本管理 |
| | 智能问答 | P1 | 二期 | RAG检索+上下文增强 |
| | 新员工训练村 | P1 | 二期 | 学习路径+游戏化+进度 |
| | AI模拟对练 | P1 | 二期 | 场景模拟+评分+建议 |
| | 考核测试 | P2 | 二期 | 自动出题+成绩统计 |

### 3.3 跨功能流转设计

| 工作流 | 流程 | 说明 |
|--------|------|------|
| **内容生产链** | 爆款拆解 → 保存模板 → 文案生成 → 朋友圈助手 → 内容日历 | 拆解爆款后仿写并排期 |
| **活动全流程** | 活动策划 → 海报制作 → 朋友圈助手 → 内容日历 → 数据分析 | 从策划到复盘一条龙 |
| **培训闭环** | 知识库更新 → 自动生成考题 → 员工学习 → AI对练 → 老板查看 | 知识沉淀到能力检验 |

---

## 4. 功能详细设计

### 4.1 自媒体工具库

#### 4.1.1 短视频脚本生成

**功能描述**

根据用户输入的主题、关键词、图片或语音，生成适用于抖音、视频号、快手等平台的短视频脚本。

**脚本类型**

| 类型 | 描述 | 输出格式 |
|------|------|----------|
| 口播脚本 | 真人出镜讲解的脚本 | 开场Hook + 内容主体 + 结尾CTA + 分镜提示 |
| 混剪脚本 | 图片/素材配音的脚本 | 分镜描述 + 配音文案 + BGM建议 |
| 情景剧本 | 有剧情的短视频脚本 | 场景 + 角色 + 台词 + 动作指导 |

**输入方式**

| 方式 | 说明 |
|------|------|
| 文字输入 | 主题/关键词/简单描述 |
| 图片上传 | 产品图/场景图（最多9张，AI分析图片内容） |
| 语音输入 | 口述想法，转文字后生成 |
| 参考视频 | 链接解析（后期支持） |

**输出规范**

- 每次生成 3-5 个不同风格版本
- 每个版本附带质量评分（Hook吸引力/内容价值/结构完整性/平台适配度/可执行性）
- 自动检测违禁词并标记
- 支持一键复制、在线编辑、局部重写、追加指令

---

#### 4.1.2 小红书笔记生成

**功能描述**

生成适合小红书平台的图文笔记，包含标题、正文、标签。

**输入方式**

- 主题/关键词
- 产品图片（最多9张）
- 语音描述
- 参考笔记（粘贴文字或截图）

**输出内容**

| 内容 | 说明 |
|------|------|
| 标题 | 3 个不同风格标题供选择 |
| 正文 | 带 emoji 分段的种草文案 |
| 标签 | 推荐相关热门标签 |
| 配图建议 | 图片顺序、封面选择建议 |

**标题优化器**

输入一个基础标题，生成 10 个爆款标题变体：
- 数字型："3个月瑜伽，我经历了这5个变化"
- 疑问型："为什么练瑜伽的人皮肤都那么好？"
- 对比型："练瑜伽前 vs 练瑜伽后，差距也太大了"
- 人群型："30+姐姐必看！这种运动最适合我们"
- 热点型："刘畊宏女孩请注意！这个运动更适合你"

---

#### 4.1.3 爆款拆解

**功能描述**

分析爆款内容的结构、技巧，提取可复用的创作模板，支持一键仿写。

**输入方式**

| 方式 | 说明 | MVP支持 |
|------|------|---------|
| 粘贴文案 | 直接复制文字内容 | ✅ |
| 上传截图 | 图片 OCR 识别 | ✅ |
| 语音描述 | 口述内容转文字 | ✅ |
| 输入链接 | 自动抓取内容 | ⏳ 后期 |

**分析维度**

| 维度 | 分析内容 |
|------|----------|
| 标题分析 | 标题类型、关键词、情绪触发点 |
| Hook分析 | 开头3秒/第一句话的吸引力技巧 |
| 结构拆解 | 内容框架、段落逻辑、节奏把控 |
| 情感曲线 | 情绪起伏设计、高潮点位置 |
| 转化设计 | 引导互动/关注/购买的技巧 |
| 可复用元素 | 句式模板、表达方式、选题角度 |

**输出内容**

1. **结构化分析卡片**
   - 各维度的分析结论
   - 可视化的结构图

2. **可复用模板**
   - 提取的通用框架
   - 填空式模板（替换关键词即可使用）

3. **本地化改编建议**
   - 如何改成适合自己行业的版本

4. **一键仿写**
   - 点击跳转「短视频脚本」或「小红书笔记」
   - 自动带入框架和风格要求

**批量拆解**

- 支持一次上传多个内容（最多 5 个）
- 批量分析后输出「共性总结」
- 发现同类爆款的通用规律

---

#### 4.1.4 文案改写

**功能描述**

将现有文案进行改写，支持多种改写模式。

**改写模式**

| 模式 | 描述 | 使用场景 |
|------|------|----------|
| 去重改写 | 保留核心意思，更换表达方式 | 避免搬运检测 |
| 风格转换 | 专业↔口语、严肃↔活泼 | 适配不同平台调性 |
| 本地化适配 | 加入城市、地标、方言元素 | 同城内容更亲切 |
| 长度调整 | 扩写（丰富细节）或缩写（精简表达） | 适配不同场景 |
| 敏感词过滤 | 检测并替换平台违禁词 | 避免限流 |

**违禁词检测**

```
支持的平台词库：
- 抖音违禁词库
- 小红书违禁词库  
- 微信违禁词库
- 通用广告法违禁词

检测结果：
- 标记所有检测到的敏感词
- 提供替换建议
- 一键替换全部
```

**输出规范**

```
- 每次生成 3 个改写版本
- 显示与原文的差异对比
- 违禁词检测报告
- 支持多轮追加修改指令
```

---

### 4.2 私域运营助理

#### 4.2.1 朋友圈助手

**功能描述**

帮助用户快速生成高质量的朋友圈文案，支持多种内容类型和输入方式。

**内容类型**

| 类型 | 描述 | 典型场景 |
|------|------|----------|
| 日常分享 | 店内场景、工作花絮 | 展示真实经营状态 |
| 专业内容 | 知识科普、行业干货 | 建立专业形象 |
| 客户见证 | 案例、好评、对比图 | 社会证明、促进信任 |
| 促销活动 | 优惠、限时、节日 | 促进转化成交 |
| 人设塑造 | 老板个人生活、价值观 | 拉近距离、建立连接 |

**输入方式**

| 方式 | 描述 |
|------|------|
| 图片配文 | 上传 1-9 张图片，AI 分析后生成文案 |
| 主题生成 | 输入关键词/主题，生成多风格文案 |
| 语音输入 | 语音描述想法，转文字后生成文案 |
| 一周计划 | 选择本周主题 + 上传素材库，AI 规划 7 天内容 |

**「一周计划」功能详解**

```
输入：
1. 本周重点主题（如：新课上线、节日活动）
2. 可用素材（图片库、事件记录）
3. 发布频率偏好（每天 1-3 条）

输出：
┌─────────────────────────────────────────────────────────┐
│ 本周朋友圈计划                                           │
├─────┬───────────┬───────────┬─────────────────────────┤
│ 日期 │ 时间      │ 类型      │ 内容预览                 │
├─────┼───────────┼───────────┼─────────────────────────┤
│ 周一 │ 08:30    │ 日常分享   │ 早安，新的一周开始...    │
│ 周一 │ 12:00    │ 专业内容   │ 你知道吗？瑜伽不只是...  │
│ 周一 │ 20:00    │ 客户见证   │ 会员@小美 坚持3个月...   │
│ 周二 │ ...      │ ...       │ ...                     │
└─────┴───────────┴───────────┴─────────────────────────┘

操作：
- 点击任意一条可编辑/重新生成
- 一键全部添加到内容日历
- 支持调整顺序和时间
```

**输出格式**

```
每条朋友圈输出：
1. 文案正文（3 个风格版本）
2. 配图建议（应该配什么类型的图）
3. AI 生成配图（可选，调用绘图 API）
4. 图片排版建议（九宫格顺序、重点图位置）
5. 发布时间建议（基于行业最佳发布时间）
```

---

#### 4.2.2 活动策划

**功能描述**

快速生成门店营销活动的完整方案。

**输出深度可选**

| 深度 | 输出内容 | 适用场景 |
|------|----------|----------|
| 快速版 | 活动创意 + 基本框架 + 主要话术 | 日常小活动、快速决策 |
| 完整版 | 完整方案 + 执行 SOP + 全套物料 | 重要活动、需要团队执行 |

**完整方案包含**

```
1. 活动概述
   - 活动名称、主题、时间
   - 目标人群、预期效果

2. 活动规则
   - 参与方式、优惠内容
   - 限制条件、注意事项

3. 执行 SOP
   - 活动前准备清单
   - 活动中执行流程
   - 活动后跟进动作

4. 话术包
   - 朋友圈预热话术（3 条）
   - 私聊邀约话术
   - 到店接待话术
   - 促单成交话术
   - 活动结束感谢话术

5. 物料清单
   - 海报设计需求（可一键跳转海报制作）
   - 门店布置建议
   - 赠品/礼品建议

6. 复盘模板
   - 数据记录表格
   - 复盘问题清单
```

**活动类型模板**

```
预设模板：
□ 新客体验活动
□ 老带新转介绍
□ 节日主题活动
□ 周年庆/店庆
□ 清仓促销
□ 会员专属活动
□ 异业合作活动
```

---

#### 4.2.3 海报制作

**功能描述**

通过 AI 生成海报设计，支持多种海报类型和尺寸。

**海报类型**

| 类型 | 描述 |
|------|------|
| 活动促销海报 | 打折、满减、限时优惠 |
| 节日营销海报 | 春节、情人节、双 11 等 |
| 课程/服务介绍 | 瑜伽课、私教、套餐介绍 |
| 客户案例海报 | Before/After 对比图 |
| 招聘海报 | 招聘教练、店员 |
| 店铺介绍海报 | 新店开业、品牌故事 |
| 朋友圈封面图 | 个人/店铺朋友圈背景 |
| 价目表/菜单 | 服务价格、产品菜单 |

**支持尺寸**

| 尺寸 | 比例 | 适用场景 |
|------|------|----------|
| 朋友圈方图 | 1:1 | 朋友圈九宫格 |
| 朋友圈长图 | 3:4 | 朋友圈长图文 |
| 小红书封面 | 3:4 | 小红书笔记首图 |
| 抖音封面 | 9:16 | 抖音视频封面 |
| A4 打印 | A4 | 线下物料、传单 |
| 自定义 | 自定义 | 其他特殊需求 |

**生成流程**

```
Step 1: 用户输入需求
        - 选择海报类型
        - 填写文案内容（标题、副标题、正文、联系方式）
        - 上传 logo/图片素材（可选）
        - 选择风格偏好（简约/活力/高级/可爱）

Step 2: AI 生成提示词
        - 展示 AI 生成的绘图提示词
        - 用户可以修改调整
        - 确认后进入下一步

Step 3: 调用绘图 API
        - 使用即梦/通义万相生成图片
        - 生成 4 张不同版本
        - 等待时显示进度

Step 4: 选择与编辑
        - 用户选择满意的版本
        - 支持「重新生成」「换个风格」
        - 下载高清大图
```

---

#### 4.2.4 运营数据分析

**功能描述**

录入并分析门店运营数据，提供趋势洞察和智能诊断建议。

**数据录入方式**

```
方式一：手动填写表单
方式二：上传 Excel 文件
方式三：拍照识别（手写数据）
```

**核心指标体系**

| 类别 | 指标 | 说明 |
|------|------|------|
| 流量指标 | 曝光量 | 内容被看到的次数 |
| | 咨询量 | 主动咨询的客户数 |
| | 到店量 | 实际到店人数 |
| 转化指标 | 咨询转化率 | 咨询→到店的比例 |
| | 成交转化率 | 到店→成交的比例 |
| | 客单价 | 平均每单金额 |
| 内容指标 | 点赞/收藏/评论 | 内容互动数据 |
| | 转发/分享 | 传播数据 |
| 私域指标 | 新增好友 | 微信新加好友数 |
| | 朋友圈互动 | 点赞评论数 |

**分析功能**

| 功能 | 描述 |
|------|------|
| 数据报表 | 日报/周报/月报，可视化图表 |
| 趋势分析 | 对比上周/上月，发现增长或下降趋势 |
| 智能诊断 | AI 分析数据异常，给出问题诊断 |
| 归因分析 | 分析哪条内容/活动带来最多转化 |
| 改进建议 | 基于数据给出具体的优化建议 |

**报告输出**

```
┌─────────────────────────────────────────────────────────┐
│ 本周运营数据报告（12.23-12.29）                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 📊 核心指标概览                                          │
│ ┌─────────┬─────────┬─────────┬─────────┐              │
│ │ 曝光量   │ 咨询量   │ 到店量   │ 成交额   │              │
│ │ 12,580  │ 48      │ 23      │ ¥8,900  │              │
│ │ ↑15%    │ ↑8%     │ ↓5%     │ ↑12%    │              │
│ └─────────┴─────────┴─────────┴─────────┘              │
│                                                         │
│ 🔍 AI 诊断                                               │
│ ⚠️ 异常发现：到店量下降但成交额上升，说明客单价提升       │
│ ✅ 亮点：周三发布的瑜伽知识科普视频带来 12 个咨询        │
│ 💡 建议：继续产出知识类内容，考虑增加同类选题           │
│                                                         │
│ 📈 趋势图表                                              │
│ [此处显示可视化图表]                                     │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

#### 4.2.5 内容日历

**功能描述**

全渠道内容排期管理，可视化展示和追踪内容发布状态。

**日历视图**

```
┌─────────────────────────────────────────────────────────────────┐
│ 2025年1月 内容日历                           [周视图] [月视图]  │
├───────┬───────┬───────┬───────┬───────┬───────┬───────────────┤
│  一   │  二   │  三   │  四   │  五   │  六   │      日       │
├───────┼───────┼───────┼───────┼───────┼───────┼───────────────┤
│       │       │   1   │   2   │   3   │   4   │       5       │
│       │       │ 📱抖音 │ 📕小红书│       │ 🎉活动 │               │
│       │       │ ✅已发 │ 📝待发 │       │ 海报  │               │
├───────┼───────┼───────┼───────┼───────┼───────┼───────────────┤
│   6   │   7   │   8   │   9   │  10   │  11   │      12       │
│ 💬朋友圈│ 📱抖音 │ 💬朋友圈│ 💬朋友圈│ 📕小红书│       │               │
│ 📝待发 │ ⏳生成中│ 📝待发 │ 📝待发 │ 📝待发 │       │               │
└───────┴───────┴───────┴───────┴───────┴───────┴───────────────┘

图例：
📱 抖音    📕 小红书    💬 朋友圈    🎬 视频号    🎉 活动
✅ 已发布   📝 待发布    ⏳ 生成中    ❌ 已取消
```

**功能特性**

| 功能 | 描述 |
|------|------|
| 多渠道管理 | 朋友圈、抖音、小红书、视频号、公众号、微博、自定义渠道 |
| 拖拽排期 | 拖拽内容卡片调整发布日期 |
| 内容预览 | 点击查看完整内容和配图 |
| 状态追踪 | 待生成/待审核/待发布/已发布/已取消 |
| 发布提醒 | 到时间推送通知提醒用户发布 |
| 批量操作 | 批量调整日期、批量删除 |
| 多视图切换 | 日视图/周视图/月视图 |

**支持渠道**

| 渠道 | 图标 | 说明 |
|------|------|------|
| 朋友圈 | 💬 | 微信朋友圈内容 |
| 抖音 | 📱 | 抖音短视频 |
| 小红书 | 📕 | 小红书笔记 |
| 视频号 | 🎬 | 微信视频号 |
| 公众号 | 📰 | 微信公众号文章 |
| 微博 | 🐦 | 微博内容 |
| 自定义 | 📌 | 其他自定义渠道 |

**与其他功能的联动**

```
从「文案生成」→ 添加到日历
从「朋友圈计划」→ 批量添加到日历
从「活动策划」→ 活动相关内容添加到日历
```

---

### 4.3 品牌知识库

#### 4.3.1 知识库管理

**功能描述**

构建店铺专属的知识体系，支持多种内容来源，AI 自动整理和检索。

**内容来源**

| 来源 | 描述 |
|------|------|
| 手动上传 | 上传 Word/PDF/图片文档 |
| 对话沉淀 | 从历史对话中选择优质内容沉淀 |
| AI 生成 | 根据产品信息自动生成 FAQ、话术 |
| 模板导入 | 导入行业通用知识模板 |

**知识类型**

```
├── 产品知识
│   ├── 产品/服务介绍
│   ├── 价格体系
│   └── 常见问题 FAQ
│
├── 销售话术
│   ├── 咨询接待话术
│   ├── 异议处理话术
│   ├── 促单成交话术
│   └── 转介绍话术
│
├── 服务标准
│   ├── 服务流程 SOP
│   ├── 注意事项
│   └── 售后处理
│
└── 品牌资料
    ├── 品牌故事
    ├── 创始人介绍
    └── 品牌荣誉
```

**版本管理**

```
- 每次更新自动保存历史版本
- 可查看任意历史版本
- 可回滚到指定版本
- 显示每个版本的更新说明和更新人
```

**AI 自动整理**

```
功能：
- 上传文档后，AI 自动提取关键信息
- 自动生成摘要和标签
- 智能去重（发现重复内容提示合并）
- 自动关联相关知识条目
```

---

#### 4.3.2 智能问答

**功能描述**

基于知识库的智能问答系统，员工随时查询，AI 引用知识库内容回答。

**技术方案：RAG（检索增强生成）**

```
查询流程：
1. 用户输入问题
2. 问题向量化
3. 在知识库中检索相似内容（Top 5）
4. 将检索结果 + 问题发送给 LLM
5. LLM 生成回答，引用原文出处
```

**输出格式**

```
┌─────────────────────────────────────────────────────────┐
│ 问：我们的私教课程怎么收费？                             │
├─────────────────────────────────────────────────────────┤
│ 答：                                                    │
│                                                         │
│ 我们的私教课程有以下几种收费方式：                        │
│                                                         │
│ 1. 单次私教：388元/节（60分钟）                         │
│ 2. 10节卡：3,580元（有效期3个月）                       │
│ 3. 20节卡：6,800元（有效期6个月）                       │
│ 4. 年度私教会员：12,800元/年（每月4节）                 │
│                                                         │
│ 首次体验可享受 198 元/节的优惠价。                       │
│                                                         │
│ ───────────────────────────────────────────────────    │
│ 📖 引用来源：                                            │
│ • 价格手册 v2.3（更新于 2025-01-01）                    │
│ • 促销政策-首次体验优惠                                 │
└─────────────────────────────────────────────────────────┘
```

**全局上下文集成**

```
知识库内容会自动注入到其他功能：
- 「文案生成」自动引用产品卖点
- 「朋友圈助手」自动引用品牌调性
- 「活动策划」自动引用历史活动经验
- 「AI 对练」基于知识库评判回答质量
```

---

#### 4.3.3 新员工培训

**功能描述**

结构化的新员工学习路径，支持多种学习形式，老板可追踪进度。

**学习路径设计**

```
┌─────────────────────────────────────────────────────────┐
│ 新员工成长地图                                           │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 🏠 Day 1-3：入职基础                                     │
│ ├── 📖 品牌故事与文化                                    │
│ ├── 📖 组织架构与制度                                    │
│ ├── 📖 基本服务礼仪                                      │
│ └── ✅ 基础考核（通过后解锁下一阶段）                     │
│                                                         │
│ 💪 Day 4-7：专业知识                                     │
│ ├── 📖 产品/服务详解                                     │
│ ├── 📖 价格体系与套餐                                    │
│ ├── 🎯 AI 对练：客户咨询场景                             │
│ └── ✅ 专业考核                                          │
│                                                         │
│ 💬 Day 8-14：销售技巧                                    │
│ ├── 📖 销售流程与话术                                    │
│ ├── 📖 异议处理技巧                                      │
│ ├── 🎯 AI 对练：异议处理场景                             │
│ ├── 🎯 AI 对练：促单成交场景                             │
│ └── ✅ 销售考核                                          │
│                                                         │
│ 🎓 Day 15-30：实战提升                                   │
│ ├── 🎯 真实客户跟进（老员工带教）                        │
│ ├── 📝 每日复盘记录                                      │
│ └── ✅ 转正考核                                          │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**学习内容形式**

| 形式 | 描述 |
|------|------|
| 📖 图文教程 | 知识库中的文档内容 |
| 🎬 视频教程 | 上传的培训视频 |
| 💬 AI 问答 | 边学边问，AI 即时解答 |
| 🎯 AI 对练 | 模拟场景对话练习 |
| ✅ 考核测试 | 选择题/问答题/场景题测试 |

**游戏化激励机制**

| 机制 | 说明 |
|------|------|
| 📈 学习进度条 | 可视化显示完成百分比 |
| ⭐ 积分系统 | 完成任务得积分，积分可兑换福利 |
| 🏆 成就徽章 | 解锁里程碑获得徽章（首次满分、连续学习7天等） |
| 📊 排行榜 | 团队学习排名，激发竞争意识 |
| 🎖️ 等级系统 | 青铜 → 白银 → 黄金 → 钻石 → 王者 |
| 🔥 连续打卡 | 连续学习天数，断签需要重新累计 |
| 💰 积分兑换 | 积分可兑换实物奖励或休假福利 |
| ⚔️ 团队PK | 小组对抗赛，团队累计积分比拼 |

**等级体系**

| 等级 | 积分要求 | 权益 |
|------|----------|------|
| 🥉 青铜 | 0-200 | 基础学习功能 |
| 🥈 白银 | 200-500 | 解锁进阶课程 |
| 🥇 黄金 | 500-1000 | 获得「金牌员工」称号 |
| 💎 钻石 | 1000-2000 | 获得实物奖励 |
| 👑 王者 | 2000+ | 获得「培训导师」资格 |

**进度追踪（老板视角）**

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 团队学习进度看板                                                          │
├─────────────────────────────────────────────────────────────────────────┤
│ 成员      │ 等级     │ 当前阶段   │ 进度   │ 积分   │ 考核成绩  │ 状态   │
├───────────┼─────────┼───────────┼────────┼────────┼──────────┼────────┤
│ 小王      │ 🥇黄金   │ 销售技巧  │ 75%   │ 850   │ 85分     │ 🟢正常  │
│ 小李      │ 🥈白银   │ 专业知识  │ 40%   │ 320   │ -        │ 🟡滞后  │
│ 小张      │ 🥉青铜   │ 入职基础  │ 100%  │ 180   │ 92分     │ 🟢完成  │
├───────────┴─────────┴───────────┴────────┴────────┴──────────┴────────┤
│ 📊 团队总览：平均进度 72% | 本周活跃 2/3 | 🔥 小王连续学习 12 天         │
│ ⚠️ 预警：小李已 3 天未学习，建议跟进                                     │
└─────────────────────────────────────────────────────────────────────────┘
```

---

#### 4.3.4 AI 模拟对练

**功能描述**

AI 扮演客户角色，与员工进行场景对话练习，自动评分和反馈。

**对练场景**

| 场景 | 描述 | 难度 |
|------|------|------|
| 客户咨询接待 | 首次咨询价格、服务内容 | ⭐ |
| 异议处理 | "太贵了"、"考虑一下" | ⭐⭐ |
| 促单成交 | 引导客户下单 | ⭐⭐⭐ |
| 售后投诉 | 处理客户不满 | ⭐⭐⭐ |
| 老客续费 | 会员到期续费沟通 | ⭐⭐ |
| 转介绍邀约 | 请老客户推荐新客户 | ⭐⭐ |

**对练流程**

```
Step 1: 选择场景
        - 选择要练习的场景
        - 查看场景背景和目标

Step 2: 开始对话
        - AI 扮演客户发起对话
        - 员工文字或语音回复
        - 多轮对话直到场景结束

Step 3: AI 评分
        - 基于知识库中的标准话术评分
        - 评估维度：专业度、亲和力、引导能力
        - 总分 + 各维度得分

Step 4: 反馈建议
        - 逐句点评（哪里说得好/哪里需要改进）
        - 标准话术参考
        - 再来一次按钮
```

**评分维度**

| 维度 | 权重 | 评判标准 |
|------|------|----------|
| 话术准确度 | 25% | 是否符合标准话术，关键信息是否准确 |
| 响应速度 | 10% | 回复是否及时，有无长时间停顿 |
| 情绪管理 | 20% | 面对刁难时的态度，是否保持耐心友好 |
| 转化能力 | 25% | 是否成功引导客户、推进销售进程 |
| 知识掌握 | 20% | 是否正确运用产品知识、价格政策 |

**评分报告示例**

```
┌─────────────────────────────────────────────────────────┐
│ 对练评分报告                                             │
├─────────────────────────────────────────────────────────┤
│ 场景：异议处理 - "太贵了"                                │
│ 总分：78/100                                            │
│                                                         │
│ 📊 各维度得分                                            │
│ ├── 话术准确度：85/100 ████████░░                       │
│ │   ✅ 准确说明了服务内容和价值                          │
│ │                                                       │
│ ├── 响应速度：90/100 █████████░                         │
│ │   ✅ 回复及时，无明显停顿                              │
│ │                                                       │
│ ├── 情绪管理：80/100 ████████░░                         │
│ │   ✅ 语气友好，有同理心                                │
│ │                                                       │
│ ├── 转化能力：70/100 ███████░░░                         │
│ │   ⚠️ 缺少价值对比，建议增加案例说明                    │
│ │                                                       │
│ └── 知识掌握：75/100 ███████░░░                         │
│     ⚠️ 第3句回复价格信息有误，参考如下：                 │
│     「我们季卡2999，年卡6999，年卡每月只要583...」        │
│                                                         │
│ 💡 改进建议                                              │
│ 1. 客户说"太贵了"时，先认同再塑造价值                    │
│ 2. 可以引用学员案例增强说服力                            │
│ 3. 建议参考标准话术：「我理解您的顾虑...」               │
│                                                         │
│ [再来一次] [换个场景] [查看完整对话]                     │
└─────────────────────────────────────────────────────────┘
```

---

#### 4.3.5 考核测试

**功能描述**

在线测试系统，检验员工知识掌握程度。

**题目类型**

| 类型 | 描述 |
|------|------|
| 单选题 | 选择一个正确答案 |
| 多选题 | 选择多个正确答案 |
| 判断题 | 判断对错 |
| 填空题 | 填写关键信息 |
| 问答题 | 开放式回答，AI 评分 |

**题库管理**

```
- 手动创建题目
- AI 根据知识库自动生成题目
- 支持从 Excel 批量导入
- 题目分类和难度标签
```

**考核设置**

```
- 设置考核名称、时间限制
- 选择题目范围（按分类/随机抽取）
- 设置及格分数
- 设置答题次数限制
```

**结果查看**

```
- 即时出分（客观题）
- AI 评分（主观题）
- 错题解析
- 团队成绩排行榜
- 知识点薄弱项分析
```

---

## 5. 通用能力设计

### 5.1 店铺档案

**功能描述**

记录店铺基本信息，作为 AI 生成内容的全局上下文。

**档案字段**

| 字段 | 必填 | 描述 |
|------|------|------|
| 店铺名称 | ✅ | 用于内容生成时自动带入 |
| 所属行业 | ✅ | 影响内容风格和模板推荐 |
| 店铺地址 | ✅ | 同城内容的地理元素 |
| 主营业务 | ✅ | 产品/服务简介 |
| 目标客户 | ❌ | 客户画像描述 |
| 品牌调性 | ❌ | 专业/亲切/活泼/高端 |
| 品牌 slogan | ❌ | 用于内容生成 |
| 联系方式 | ❌ | 海报等物料使用 |
| Logo | ❌ | 海报等物料使用 |

**多店铺支持**

```
- 一个账号可创建多个店铺
- 每个店铺独立的档案、知识库、内容
- 切换店铺时，AI 上下文自动切换
- 店铺之间可共享素材库
```

---

### 5.2 内容风格偏好

**功能描述**

用户设置个性化的内容风格，AI 生成时自动遵循。

**可设置项**

| 设置项 | 选项 | 影响 |
|------|------|------|
| 文案风格 | 专业严谨/亲切温暖/活泼俏皮/简约干练 | 用词和语气 |
| Emoji 使用 | 不使用/少量使用/适量使用/大量使用 | emoji 数量 |
| 常用签名 | 自定义文字 | 文案结尾自动添加 |
| 禁用词 | 自定义词汇列表 | 生成时自动避免 |
| 常用标签 | 自定义标签列表 | 小红书笔记等自动添加 |

---

### 5.3 素材库

**功能描述**

统一管理各类素材，方便内容创作时调用。

**素材类型**

| 类型 | 描述 |
|------|------|
| 图片素材 | 产品图、环境图、活动照片 |
| 文案素材 | 收藏的好文案、常用表达 |
| 模板素材 | 常用的内容框架 |
| 客户案例 | 客户见证、对比图、好评截图 |

**功能特性**

```
- 支持文件夹分类管理
- 支持标签筛选
- 支持搜索
- 拖拽上传
- 在内容生成时可快速调用
```

---

### 5.4 历史记录与收藏

**功能描述**

记录所有 AI 生成的内容，支持收藏和管理。

**历史记录**

```
- 按时间倒序展示
- 按功能模块筛选
- 关键词搜索
- 查看完整对话上下文
- 基于历史记录继续对话
```

**收藏夹**

```
- 收藏任意 AI 生成的内容
- 分类管理收藏
- 收藏内容可直接复用
```

**导出功能**

```
- 导出为 Markdown
- 导出为 Word
- 导出为 PDF
- 批量导出
```

---

### 5.5 多用户与权限

**角色定义**

| 角色 | 权限范围 |
|------|----------|
| 老板/管理员 | 全部权限，包括团队管理、数据查看、订阅管理 |
| 运营人员 | 内容创作、素材管理、数据录入 |
| 普通员工 | 知识库查询、培训学习、AI 对练 |
| 自定义角色 | 自定义权限组合 |

**协作功能**

```
- 老板可查看所有人的工作记录
- 员工生成的内容可提交审核
- 共享素材库和知识库
- 老板可查看团队培训进度
```

---

### 5.6 内容编辑能力

**二次编辑方式**

| 方式 | 描述 |
|------|------|
| 重新生成 | 完全重新生成一版 |
| 在线编辑 | 直接修改 AI 生成的文字 |
| 局部重写 | 选中某句话，让 AI 重写这部分 |
| 追加指令 | 在当前基础上继续优化（如"再活泼一点"） |

---

### 5.7 跨功能流转

**流转路径**

| 起点 | 目标 | 操作 |
|------|------|------|
| 爆款拆解 | 文案生成 | 一键「用这个框架仿写」 |
| 文案生成 | 朋友圈助手 | 一键「转为朋友圈版本」 |
| 任意内容生成 | 内容日历 | 一键「添加到日历」 |
| 任意内容生成 | 素材库 | 一键「保存到素材库」 |
| 任意对话 | 知识库 | 一键「沉淀到知识库」 |
| 活动策划 | 海报制作 | 一键「生成活动海报」 |
| 数据分析 | 知识库 | 一键「保存复盘报告」 |

---

## 6. 技术架构

### 6.1 系统架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                客户端层                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│    ┌──────────────┐   ┌──────────────┐   ┌──────────────┐                  │
│    │   iOS App    │   │  微信小程序   │   │  Web 浏览器  │                  │
│    └──────┬───────┘   └──────┬───────┘   └──────┬───────┘                  │
│           │                  │                  │                           │
│           └──────────────────┼──────────────────┘                           │
│                              │                                              │
│                              ▼                                              │
│    ┌────────────────────────────────────────────────────────────────────┐  │
│    │                         API Gateway                                 │  │
│    │              (认证、限流、日志、错误处理)                             │  │
│    └────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     │ HTTPS
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                                服务层                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│    ┌────────────────────────────────────────────────────────────────────┐  │
│    │                      Next.js API Routes                             │  │
│    │                                                                     │  │
│    │  ┌─────────────────────────────────────────────────────────────┐   │  │
│    │  │                        业务模块                              │   │  │
│    │  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐        │   │  │
│    │  │  │  自媒体  │  │  私域   │  │ 知识库  │  │  用户   │        │   │  │
│    │  │  │  工具库  │  │  运营   │  │  培训   │  │  权限   │        │   │  │
│    │  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘        │   │  │
│    │  └─────────────────────────────────────────────────────────────┘   │  │
│    │                              │                                      │  │
│    │  ┌─────────────────────────────────────────────────────────────┐   │  │
│    │  │                      核心服务层                              │   │  │
│    │  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐        │   │  │
│    │  │  │ AI调度器│  │ 知识检索│  │ 文件处理│  │ 通知推送│        │   │  │
│    │  │  │Dispatcher│  │   RAG   │  │ 压缩/OCR │  │ App/微信│        │   │  │
│    │  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘        │   │  │
│    │  └─────────────────────────────────────────────────────────────┘   │  │
│    │                                                                     │  │
│    └────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                               数据层                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│    ┌──────────────┐   ┌──────────────┐   ┌──────────────┐                  │
│    │   Supabase   │   │  向量数据库   │   │   对象存储   │                  │
│    │  PostgreSQL  │   │   (Pinecone)  │   │  (Supabase)  │                  │
│    │              │   │              │   │              │                  │
│    │  - 用户数据  │   │  - 知识库    │   │  - 图片文件  │                  │
│    │  - 业务数据  │   │    向量索引  │   │  - 文档文件  │                  │
│    │  - 配置数据  │   │              │   │  - 音视频   │                  │
│    └──────────────┘   └──────────────┘   └──────────────┘                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              AI 服务层                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│    ┌──────────────┐   ┌──────────────┐   ┌──────────────┐                  │
│    │    Claude    │   │  SiliconFlow │   │    绘图 AI   │                  │
│    │   (Anthropic)│   │  (语音转写)  │   │              │                  │
│    │              │   │              │   │  - 即梦      │                  │
│    │  - 文案生成  │   │  - 语音转文字│   │  - 通义万相  │                  │
│    │  - 内容分析  │   │  - 图片分析  │   │              │                  │
│    │  - 智能问答  │   │              │   │              │                  │
│    └──────────────┘   └──────────────┘   └──────────────┘                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 6.2 AI 调度器设计

```typescript
// lib/ai/dispatcher.ts

interface AIRequest {
  // 功能标识
  feature: 'copywriting' | 'analysis' | 'rewrite' | 'qa' | 'roleplay'
  
  // 用户输入
  message: string
  attachments?: Attachment[]  // 图片/文件
  
  // 上下文
  shopProfile: ShopProfile     // 店铺档案
  knowledgeContext?: string[]  // 知识库相关内容
  stylePreference?: StylePref  // 风格偏好
  conversationHistory?: Message[]
  
  // 配置
  outputVersions?: number      // 输出版本数
  modelOverride?: string       // 模型覆盖
}

interface AIResponse {
  versions: ContentVersion[]   // 多版本输出
  qualityScore?: number        // 质量评分
  warnings?: Warning[]         // 违禁词等警告
  suggestions?: string[]       // 优化建议
  references?: Reference[]     // 引用来源
}

async function dispatchAI(request: AIRequest): Promise<AIResponse> {
  // 1. 构建系统提示词（含店铺档案、风格偏好）
  const systemPrompt = buildSystemPrompt(request)
  
  // 2. 注入知识库上下文（RAG）
  if (request.knowledgeContext) {
    systemPrompt += buildKnowledgeContext(request.knowledgeContext)
  }
  
  // 3. 处理多模态输入
  let userMessage = request.message
  if (request.attachments?.length > 0) {
    const analysis = await analyzeAttachments(request.attachments)
    userMessage = `${analysis}\n\n${request.message}`
  }
  
  // 4. 调用 AI 模型
  const response = await callLLM(systemPrompt, userMessage)
  
  // 5. 后处理（违禁词检测、质量评分）
  const processed = await postProcess(response, request.feature)
  
  return processed
}
```

---

## 7. AI 能力设计

### 7.1 设计原则

| 原则 | 说明 |
|------|------|
| **按功能分配模型** | 不同功能使用最适合的模型，平衡质量和成本 |
| **可替换架构** | 通过统一的 AI 调度层，后期可随时切换模型 |
| **降级兜底** | 主模型不可用时自动切换到备选模型 |
| **成本可控** | 简单任务用轻量模型，复杂任务用强模型 |

### 7.2 模型资源池

#### 7.2.1 文本生成模型

| 模型 | 提供商 | 能力等级 | 适用场景 | 参考价格 |
|------|--------|----------|----------|----------|
| Claude 3.5 Sonnet | Anthropic | ⭐⭐⭐⭐⭐ | 复杂分析、角色扮演、图片理解 | $3/M input, $15/M output |
| Claude 3.5 Haiku | Anthropic | ⭐⭐⭐⭐ | 快速生成、简单任务 | $0.25/M input, $1.25/M output |
| Qwen-Max | 通义 | ⭐⭐⭐⭐⭐ | 中文理解、复杂推理 | ¥0.02/千tokens |
| Qwen-Turbo | 通义 | ⭐⭐⭐ | 快速生成、成本敏感 | ¥0.002/千tokens |
| GLM-4-Flash | SiliconFlow | ⭐⭐⭐ | 简单任务、兜底 | 免费额度 |
| DeepSeek-V2 | SiliconFlow | ⭐⭐⭐⭐ | 长文本、性价比 | ¥0.001/千tokens |

#### 7.2.2 图像生成模型

| 模型 | 提供商 | 适用场景 | 参考价格 |
|------|--------|----------|----------|
| 即梦 | 字节跳动 | 海报、营销图 | ¥0.1/张 |
| 通义万相 | 阿里云 | 海报、产品图 | ¥0.08/张 |

#### 7.2.3 多模态模型

| 模型 | 提供商 | 能力 | 适用场景 |
|------|--------|------|----------|
| Claude 3.5 Sonnet | Anthropic | 图片理解 | 分析用户上传的图片 |
| Qwen-VL-Max | 通义 | 图片理解 | 图片分析备选 |

#### 7.2.4 语音模型

| 模型 | 提供商 | 能力 | 适用场景 |
|------|--------|------|----------|
| Whisper | SiliconFlow | 语音转文字 | 语音输入 |
| 讯飞语音 | 讯飞 | 语音转文字 | 备选 |
| 阿里云语音 | 阿里云 | 语音转文字 | 备选 |

#### 7.2.5 向量模型

| 模型 | 提供商 | 维度 | 适用场景 |
|------|--------|------|----------|
| text-embedding-v3 | 通义 | 1024 | 知识库文档向量化、RAG 检索 |

### 7.3 功能-模型映射表

| 模块 | 功能 | 主模型 | 备选模型 | 特殊能力 | 复杂度 |
|------|------|--------|----------|----------|--------|
| **自媒体** | 短视频脚本生成 | Claude Haiku | Qwen-Turbo | 图片理解: Claude Sonnet | 中 |
| | 小红书笔记生成 | Claude Haiku | Qwen-Turbo | 图片理解: Claude Sonnet | 中 |
| | 爆款拆解 | Claude Sonnet | Qwen-Max | 图片OCR: Claude Sonnet | 高 |
| | 文案改写 | Qwen-Turbo | GLM-4-Flash | - | 低 |
| **私域** | 朋友圈助手 | Claude Haiku | Qwen-Turbo | 图片理解: Claude Sonnet | 中 |
| | 内容日历 | - | - | 无 AI 调用 | - |
| | 活动策划 | Claude Sonnet | Qwen-Max | - | 高 |
| | 海报制作-文案 | Claude Haiku | Qwen-Turbo | - | 低 |
| | 海报制作-生图 | 即梦 | 通义万相 | - | - |
| | 运营数据分析 | Claude Sonnet | Qwen-Max | - | 高 |
| **知识库** | 文档整理/摘要 | Qwen-Turbo | GLM-4-Flash | - | 低 |
| | 智能问答 (RAG) | Claude Sonnet | Qwen-Max | Embedding: 通义 v3 | 高 |
| | AI 模拟对练 | Claude Sonnet | Qwen-Max | - | 高 |
| | 考核出题 | Qwen-Turbo | GLM-4-Flash | - | 低 |
| | 答案批改 | Claude Haiku | Qwen-Turbo | - | 中 |
| **通用** | 违禁词检测 | 规则引擎优先 | Qwen-Turbo 兜底 | - | 低 |
| | 质量评分 | Claude Haiku | Qwen-Turbo | - | 低 |
| | 语音转文字 | SiliconFlow Whisper | 讯飞 | - | - |
| | 图片 OCR | Claude Sonnet | Qwen-VL | - | - |

### 7.4 AI 调度层架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              AI 调度层 (AI Dispatcher)                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        统一请求入口                                  │   │
│  │  AIRequest { feature, message, attachments, context, config }       │   │
│  └──────────────────────────────┬──────────────────────────────────────┘   │
│                                 │                                           │
│                                 ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        请求预处理                                    │   │
│  │  1. 参数校验                                                         │   │
│  │  2. 加载店铺档案 + 风格偏好                                          │   │
│  │  3. 知识库 RAG 检索（如需要）                                        │   │
│  │  4. 图片/语音预处理                                                  │   │
│  └──────────────────────────────┬──────────────────────────────────────┘   │
│                                 │                                           │
│                                 ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        模型路由器                                    │   │
│  │  根据 feature + 配置 选择模型                                        │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐       │   │
│  │  │ Claude  │ │ Qwen    │ │ GLM     │ │ 即梦    │ │ Whisper │       │   │
│  │  │ Sonnet  │ │ Max     │ │ Flash   │ │ 绘图    │ │ 语音    │       │   │
│  │  └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘       │   │
│  │       │           │           │           │           │             │   │
│  │       └───────────┴───────────┴───────────┴───────────┘             │   │
│  │                               │                                      │   │
│  └───────────────────────────────┼──────────────────────────────────────┘   │
│                                  │                                          │
│                                  ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        响应后处理                                    │   │
│  │  1. 违禁词检测                                                       │   │
│  │  2. 质量评分                                                         │   │
│  │  3. 多版本格式化                                                     │   │
│  │  4. 日志记录 + Token 统计                                            │   │
│  └──────────────────────────────┬──────────────────────────────────────┘   │
│                                 │                                           │
│                                 ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        统一响应出口                                  │   │
│  │  AIResponse { versions, qualityScore, warnings, usage }             │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 7.5 模型配置管理

```typescript
// lib/ai/config.ts

// 模型配置（可通过环境变量或数据库动态调整）
export const MODEL_CONFIG = {
  // 文本生成模型
  text: {
    high: {
      provider: 'anthropic',
      model: 'claude-3-5-sonnet-20241022',
      fallback: { provider: 'tongyi', model: 'qwen-max' }
    },
    medium: {
      provider: 'anthropic', 
      model: 'claude-3-5-haiku-20241022',
      fallback: { provider: 'tongyi', model: 'qwen-turbo' }
    },
    low: {
      provider: 'tongyi',
      model: 'qwen-turbo',
      fallback: { provider: 'siliconflow', model: 'glm-4-flash' }
    }
  },
  
  // 图像生成模型
  image: {
    primary: { provider: 'jimeng', model: 'jimeng-2.1' },
    fallback: { provider: 'tongyi', model: 'wanx-v1' }
  },
  
  // 视觉理解模型
  vision: {
    primary: { provider: 'anthropic', model: 'claude-3-5-sonnet-20241022' },
    fallback: { provider: 'tongyi', model: 'qwen-vl-max' }
  },
  
  // 语音识别模型
  speech: {
    primary: { provider: 'siliconflow', model: 'whisper-large-v3' },
    fallback: { provider: 'xunfei', model: 'iat' }
  },
  
  // 向量模型
  embedding: {
    provider: 'tongyi',
    model: 'text-embedding-v3',
    dimension: 1024
  }
}

// 功能到模型等级的映射
export const FEATURE_MODEL_MAP: Record<string, 'high' | 'medium' | 'low'> = {
  // 自媒体工具库
  'video_script': 'medium',
  'xiaohongshu': 'medium', 
  'viral_analyze': 'high',
  'rewrite': 'low',
  
  // 私域运营助理
  'moments': 'medium',
  'campaign': 'high',
  'poster_copy': 'low',
  'analytics': 'high',
  
  // 品牌知识库
  'knowledge_qa': 'high',
  'ai_practice': 'high',
  'exam_generate': 'low',
  'exam_grade': 'medium',
  'doc_summary': 'low',
  
  // 通用
  'quality_score': 'low',
  'forbidden_check': 'low'
}
```

### 7.6 各功能 AI 调用详细设计

#### 7.6.1 短视频脚本生成

**调用流程**

```
用户输入 → 图片分析(可选) → 加载上下文 → 生成脚本 → 质量评分 → 违禁词检测 → 返回结果
    │           │                │              │
    │      Claude Sonnet     店铺档案      Claude Haiku
    │      (仅有图片时)      + 知识库      
    ▼                                          ▼
  文字/语音/图片                          3个风格版本 + 评分
```

**模型配置**

| 步骤 | 模型 | 说明 |
|------|------|------|
| 图片理解 | Claude Sonnet | 分析用户上传的产品图/场景图 |
| 脚本生成 | Claude Haiku | 主力生成模型 |
| 质量评分 | Claude Haiku | 复用同一模型 |

**系统提示词模板**

```markdown
# 角色设定
你是一位专业的短视频脚本创作专家，专门为实体店创作适合抖音、视频号等平台的营销短视频脚本。

# 店铺信息
- 店铺名称：{{shop_name}}
- 所属行业：{{industry}}
- 主营业务：{{main_business}}
- 目标客户：{{target_customer}}
- 品牌调性：{{brand_style}}
- 核心卖点：{{selling_points}}

# 任务要求
根据用户提供的主题/素材，生成短视频脚本。

# 输出格式
请生成 3 个不同风格的版本，每个版本包含：
1. 风格标签（如：专业干货版/亲切日常版/热点结合版）
2. 脚本类型（口播/混剪/情景）
3. 预估时长
4. 完整脚本内容：
   - 🎣 开场 Hook（前3秒抓住注意力）
   - 📝 内容主体（核心价值点）
   - 📢 结尾 CTA（引导关注/评论/私信）
5. 拍摄建议（场景、道具、表情）
6. BGM 风格建议

# 创作原则
1. Hook 必须在 3 秒内抓住注意力
2. 内容要有价值感，不能纯广告
3. 语言要口语化，像朋友聊天
4. 结尾要有明确的行动指引
5. 适配{{platform}}平台的调性

# 禁止内容
- 不要使用绝对化用语（最好、第一、顶级等）
- 不要虚假承诺效果
- 不要贬低竞争对手
```

**用户提示词模板**

```markdown
# 创作需求
- 内容主题：{{topic}}
- 目标平台：{{platform}}
- 脚本类型：{{script_type}}
- 时长要求：{{duration}}
- 风格偏好：{{style_preference}}

{{#if image_analysis}}
# 图片素材分析
{{image_analysis}}
{{/if}}

{{#if reference}}
# 参考内容
{{reference}}
{{/if}}

{{#if additional_requirements}}
# 额外要求
{{additional_requirements}}
{{/if}}

请根据以上信息生成 3 个不同风格的短视频脚本。
```

**输入输出数据结构**

```typescript
// 请求
interface VideoScriptRequest {
  topic: string                    // 主题
  platform: 'douyin' | 'shipinhao' | 'kuaishou'
  scriptType: 'oral' | 'mashup' | 'drama'  // 口播/混剪/情景
  duration: '15s' | '30s' | '60s'
  style?: 'professional' | 'casual' | 'trendy'
  images?: string[]                // 图片 URL
  reference?: string               // 参考内容
  additionalRequirements?: string
}

// 响应
interface VideoScriptResponse {
  versions: Array<{
    id: string
    style: string                  // 风格标签
    type: string                   // 脚本类型
    duration: string               // 预估时长
    content: {
      hook: string                 // 开场 Hook
      body: string                 // 内容主体
      cta: string                  // 结尾引导
    }
    shootingTips: string           // 拍摄建议
    bgmSuggestion: string          // BGM 建议
    fullScript: string             // 完整脚本
  }>
  qualityScore: {
    total: number                  // 总分 0-100
    dimensions: {
      hookAppeal: number           // Hook 吸引力
      contentValue: number         // 内容价值
      structure: number            // 结构完整性
      platformFit: number          // 平台适配度
      feasibility: number          // 可执行性
    }
  }
  forbiddenWords: Array<{
    word: string
    position: number
    suggestion: string
  }>
  tokenUsage: {
    input: number
    output: number
    cost: number
  }
}
```

**成本估算**

| 场景 | 输入 Token | 输出 Token | 成本（Claude Haiku）|
|------|-----------|-----------|-------------------|
| 纯文字输入 | ~800 | ~2000 | ~$0.003 |
| 带图片输入 | ~1500 | ~2000 | ~$0.005 |
| 含图片分析 | +1000 | - | +$0.003 (Sonnet) |

---

#### 7.6.2 小红书笔记生成

**调用流程**

```
用户输入 → 图片分析(可选) → 加载上下文 → 生成笔记 → 标题优化 → 违禁词检测 → 返回结果
```

**模型配置**

| 步骤 | 模型 | 说明 |
|------|------|------|
| 图片理解 | Claude Sonnet | 分析产品图提取卖点 |
| 笔记生成 | Claude Haiku | 生成正文 + 标签 |
| 标题优化 | Claude Haiku | 生成多个爆款标题 |

**系统提示词模板**

```markdown
# 角色设定
你是一位资深小红书运营专家，擅长创作高互动、易种草的小红书笔记。

# 店铺信息
{{shop_context}}

# 任务要求
根据用户提供的主题/素材，生成小红书笔记。

# 输出格式
请生成 3 个版本，每个版本包含：
1. 标题（3 个可选标题）
2. 正文（带 emoji、分段、口语化）
3. 标签推荐（5-8 个相关热门标签）
4. 配图建议

# 小红书爆款公式
- 标题：数字 + 痛点/好奇心 + 解决方案
- 开头：共情/提问/反常识
- 内容：真实体验 + 干货价值
- 结尾：互动引导

# 标题类型参考
- 数字型：「3招教你...」「坚持xx天后...」
- 疑问型：「为什么...？」「...真的有用吗？」
- 对比型：「xx前 vs xx后」
- 人群型：「xx人必看！」「xx党狂喜」
- 测评型：「亲测有效！」「真实体验...」
```

---

#### 7.6.3 爆款拆解

**调用流程**

```
用户输入 → OCR/解析 → 深度分析 → 结构化输出 → 生成可复用模板
    │          │           │
    │     Claude Sonnet   Claude Sonnet
    │     (图片OCR)       (深度分析)
    ▼
  文字/截图/链接
```

**模型配置**

| 步骤 | 模型 | 说明 |
|------|------|------|
| 图片 OCR | Claude Sonnet | 识别截图中的文字 |
| 深度分析 | Claude Sonnet | 多维度拆解分析 |
| 模板提取 | Claude Sonnet | 提取可复用框架 |

**系统提示词模板**

```markdown
# 角色设定
你是一位资深内容分析专家，擅长拆解爆款内容的底层逻辑和可复用套路。

# 任务要求
对用户提供的内容进行深度拆解分析。

# 分析维度
1. **基本信息判断**
   - 内容类型（短视频脚本/图文笔记/朋友圈）
   - 所属领域
   - 目标受众

2. **Hook 分析**
   - 原文 Hook
   - 使用的技巧（好奇心/痛点/反常识/数字/对比等）
   - 可复用的 Hook 模板

3. **结构拆解**
   - 内容框架（总分总/问题-方案/故事-道理等）
   - 各部分占比
   - 节奏把控

4. **爆款元素识别**
   - 选题角度
   - 人设塑造
   - 表达技巧
   - 情感共鸣点
   - 转化设计

5. **可复用模板**
   - 标题模板：_______________
   - 结构模板：_______________
   - 话术模板：_______________

6. **本地化改编建议**
   - 如何改编为{{industry}}行业版本
   - 需要调整的关键点

# 输出格式
请使用结构化的 JSON 格式输出分析结果。
```

**输出数据结构**

```typescript
interface ViralAnalysisResponse {
  basicInfo: {
    contentType: string
    industry: string
    targetAudience: string
    estimatedData: {
      views: string
      likes: string
      comments: string
    }
  }
  hookAnalysis: {
    originalHook: string
    technique: string[]
    reusableTemplate: string
  }
  structureAnalysis: {
    framework: string
    sections: Array<{
      name: string
      content: string
      percentage: number
      purpose: string
    }>
  }
  viralElements: {
    topicAngle: string
    persona: string
    expression: string[]
    emotionalPoints: string[]
    conversionDesign: string
  }
  reusableTemplates: {
    titleTemplate: string
    structureTemplate: string
    scriptTemplate: string
  }
  adaptationSuggestions: string[]
}
```

---

#### 7.6.4 文案改写

**调用流程**

```
原始文案 → 改写处理 → 违禁词检测 → 返回多版本
              │
         Qwen-Turbo (低成本)
```

**模型配置**

| 步骤 | 模型 | 说明 |
|------|------|------|
| 改写 | Qwen-Turbo | 简单任务，成本优先 |
| 违禁词检测 | 规则引擎 | 优先规则匹配 |

**系统提示词模板**

```markdown
# 角色设定
你是一位专业的文案改写专家。

# 任务要求
根据用户的改写需求，对原文进行改写。

# 改写模式
{{#if mode == 'dedup'}}
## 去重改写
- 保留核心意思，更换表达方式
- 调整句子结构
- 替换同义词
- 确保与原文相似度低于 30%
{{/if}}

{{#if mode == 'style'}}
## 风格转换
- 目标风格：{{target_style}}
- 保持核心信息不变
- 调整语气和用词
{{/if}}

{{#if mode == 'localize'}}
## 本地化适配
- 目标城市：{{city}}
- 加入本地化元素（地标、方言、习惯）
- 增强亲切感
{{/if}}

{{#if mode == 'length'}}
## 长度调整
- 目标长度：{{target_length}}
- 扩写：增加细节、案例、情感
- 缩写：保留核心，删除冗余
{{/if}}

# 输出要求
- 生成 3 个改写版本
- 每个版本标注改写要点
- 显示与原文的差异点
```

---

#### 7.6.5 朋友圈助手

**调用流程**

```
用户输入 → 图片分析(可选) → 加载上下文 → 生成文案 → 返回多版本
    │           │                │              │
    │      Claude Sonnet     店铺档案      Claude Haiku
    ▼          (图片理解)      + 偏好
  图片/主题/语音
```

**模型配置**

| 步骤 | 模型 | 说明 |
|------|------|------|
| 图片理解 | Claude Sonnet | 分析图片内容 |
| 文案生成 | Claude Haiku | 生成朋友圈文案 |

**系统提示词模板**

```markdown
# 角色设定
你是一位专业的私域运营专家，擅长撰写高质量的朋友圈文案。

# 店铺信息
{{shop_context}}

# 风格偏好
- 文案风格：{{style}}
- Emoji 使用：{{emoji_level}}
- 签名：{{signature}}

# 内容类型
{{#if type == 'daily'}}
日常分享：展示真实经营状态，拉近与客户的距离
{{/if}}
{{#if type == 'professional'}}
专业内容：知识科普，建立专业形象
{{/if}}
{{#if type == 'testimonial'}}
客户见证：案例展示，增强信任感
{{/if}}
{{#if type == 'promotion'}}
促销活动：突出优惠，制造紧迫感
{{/if}}
{{#if type == 'persona'}}
人设塑造：展示个人生活，建立情感连接
{{/if}}

# 输出格式
请生成 3 个不同风格的版本，每个版本包含：
1. 文案正文（适合朋友圈的长度）
2. 配图建议
3. 发布时间建议
```

---

#### 7.6.6 活动策划

**调用流程**

```
活动需求 → 深度规划 → 生成完整方案 → 拆解执行项
              │
         Claude Sonnet (复杂推理)
```

**模型配置**

| 步骤 | 模型 | 说明 |
|------|------|------|
| 方案生成 | Claude Sonnet | 需要复杂推理和创意 |

**系统提示词模板**

```markdown
# 角色设定
你是一位资深的门店营销策划专家，擅长为实体店策划各类营销活动。

# 店铺信息
{{shop_context}}

# 活动需求
- 活动类型：{{activity_type}}
- 活动目标：{{goal}}
- 预算范围：{{budget}}
- 活动时间：{{date_range}}
- 目标人群：{{target_audience}}

# 输出方案
{{#if depth == 'quick'}}
## 快速版（简要方案）
1. 活动主题和核心玩法
2. 关键时间节点
3. 核心话术（3条朋友圈预热）
{{/if}}

{{#if depth == 'full'}}
## 完整版（详细方案）
1. **活动概览**
   - 活动名称
   - 活动主题
   - 活动时间
   - 目标人群
   - 预期效果

2. **活动规则**
   - 参与方式
   - 优惠内容
   - 限制条件

3. **执行 SOP**
   - 活动前准备清单
   - 活动中执行流程
   - 活动后跟进动作

4. **话术包**
   - 朋友圈预热话术（3条）
   - 私聊邀约话术
   - 到店接待话术
   - 促单话术
   - 活动结束感谢话术

5. **物料清单**
   - 海报需求描述
   - 门店布置建议
   - 赠品/礼品建议

6. **复盘模板**
   - 数据记录表
   - 复盘问题清单
{{/if}}
```

---

#### 7.6.7 海报制作

**调用流程**

```
用户需求 → 生成提示词 → 用户确认 → 调用绘图API → 返回图片
    │           │                        │
    │      Claude Haiku              即梦/万相
    ▼
  海报类型 + 文案需求
```

**模型配置**

| 步骤 | 模型 | 说明 |
|------|------|------|
| 提示词生成 | Claude Haiku | 生成绘图提示词 |
| 图像生成 | 即梦 | 生成海报图片 |
| 备选 | 通义万相 | 即梦不可用时 |

**提示词生成模板**

```markdown
# 角色设定
你是一位专业的 AI 绘图提示词工程师，擅长为营销海报生成高质量的绘图提示词。

# 海报需求
- 海报类型：{{poster_type}}
- 尺寸：{{size}}
- 主标题：{{title}}
- 副标题：{{subtitle}}
- 正文内容：{{body}}
- 联系方式：{{contact}}
- 风格偏好：{{style}}

# 输出格式
请生成即梦/通义万相可用的中文绘图提示词，包含：
1. 主体描述
2. 风格描述
3. 色彩描述
4. 构图描述
5. 文字位置预留说明

注意：
- 提示词要具体、可执行
- 预留文字区域（AI 绘图后需要叠加文字）
- 适合营销场景
```

---

#### 7.6.8 运营数据分析

**调用流程**

```
数据输入 → 数据清洗 → AI分析 → 生成报告
              │           │
              │      Claude Sonnet (深度分析)
              ▼
         结构化数据
```

**模型配置**

| 步骤 | 模型 | 说明 |
|------|------|------|
| 数据分析 | Claude Sonnet | 需要数据理解和推理能力 |
| 报告生成 | Claude Sonnet | 需要结构化表达 |

**系统提示词模板**

```markdown
# 角色设定
你是一位资深的门店运营数据分析师，擅长从数据中发现问题和机会。

# 店铺背景
{{shop_context}}

# 分析数据
{{data}}

# 分析维度
1. **核心指标概览**
   - 曝光量、互动量、咨询量、到店量、成交量
   - 环比/同比变化

2. **趋势分析**
   - 识别上升/下降趋势
   - 异常波动点

3. **智能诊断**
   - 发现异常情况
   - 分析可能原因
   - 识别亮点

4. **归因分析**
   - 哪条内容带来最多转化
   - 高转化内容的共性

5. **优化建议**
   - 具体可执行的改进建议
   - 优先级排序

# 输出格式
请生成结构化的分析报告。
```

---

#### 7.6.9 智能问答 (RAG)

**调用流程**

```
用户问题 → 问题向量化 → 知识库检索 → 构建上下文 → LLM生成 → 返回答案
              │              │              │           │
         通义Embedding    pgvector      Top 5       Claude Sonnet
              │              │           文档片段
              ▼              ▼
         1024维向量      相似度匹配
```

**模型配置**

| 步骤 | 模型 | 说明 |
|------|------|------|
| 问题向量化 | 通义 text-embedding-v3 | 1024 维向量 |
| 知识检索 | pgvector | 余弦相似度 Top 5 |
| 答案生成 | Claude Sonnet | 基于检索内容生成 |

**RAG 实现代码**

```typescript
// lib/ai/rag.ts

import { createClient } from '@supabase/supabase-js'

// 向量化
async function embedText(text: string): Promise<number[]> {
  const response = await fetch('https://dashscope.aliyuncs.com/api/v1/services/embeddings/text-embedding/text-embedding', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${process.env.TONGYI_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      model: 'text-embedding-v3',
      input: { texts: [text] },
      parameters: { dimension: 1024 }
    })
  })
  
  const data = await response.json()
  return data.output.embeddings[0].embedding
}

// 检索相关知识
async function retrieveKnowledge(
  shopId: string, 
  query: string, 
  topK: number = 5
): Promise<KnowledgeChunk[]> {
  const queryEmbedding = await embedText(query)
  
  const { data, error } = await supabase.rpc('match_knowledge', {
    shop_id: shopId,
    query_embedding: queryEmbedding,
    match_threshold: 0.7,
    match_count: topK
  })
  
  return data
}

// RAG 问答
async function ragAnswer(shopId: string, question: string): Promise<RAGResponse> {
  // 1. 检索相关知识
  const chunks = await retrieveKnowledge(shopId, question, 5)
  
  // 2. 构建上下文
  const context = chunks.map(c => 
    `【来源：${c.title}】\n${c.content}`
  ).join('\n\n---\n\n')
  
  // 3. 调用 LLM
  const response = await callClaude({
    model: 'claude-3-5-sonnet-20241022',
    system: `你是店铺的智能客服助手。请基于以下知识库内容回答用户问题。
如果知识库中没有相关信息，请如实说明。
回答时请引用来源。

【知识库内容】
${context}`,
    messages: [{ role: 'user', content: question }]
  })
  
  return {
    answer: response.content,
    sources: chunks.map(c => ({
      id: c.id,
      title: c.title,
      excerpt: c.content.slice(0, 100),
      score: c.similarity
    }))
  }
}
```

**数据库函数**

```sql
-- 创建知识检索函数
CREATE OR REPLACE FUNCTION match_knowledge(
  shop_id UUID,
  query_embedding vector(1024),
  match_threshold float,
  match_count int
)
RETURNS TABLE (
  id UUID,
  document_id UUID,
  title TEXT,
  content TEXT,
  similarity float
)
LANGUAGE plpgsql
AS $$
BEGIN
  RETURN QUERY
  SELECT
    ke.id,
    ke.document_id,
    kd.title,
    ke.chunk_text as content,
    1 - (ke.embedding <=> query_embedding) as similarity
  FROM knowledge_embeddings ke
  JOIN knowledge_documents kd ON ke.document_id = kd.id
  WHERE kd.shop_id = match_knowledge.shop_id
    AND 1 - (ke.embedding <=> query_embedding) > match_threshold
  ORDER BY ke.embedding <=> query_embedding
  LIMIT match_count;
END;
$$;
```

---

#### 7.6.10 AI 模拟对练

**调用流程**

```
选择场景 → AI发起对话 → 用户回复 → AI扮演客户回复 → 循环... → 对话结束 → AI评分
                │                     │                            │
           Claude Sonnet         Claude Sonnet              Claude Sonnet
           (生成开场)            (角色扮演)                  (多维度评分)
```

**模型配置**

| 步骤 | 模型 | 说明 |
|------|------|------|
| 角色扮演 | Claude Sonnet | 需要自然对话和角色扮演能力 |
| 评分反馈 | Claude Sonnet | 需要理解对话质量 |

**系统提示词模板（角色扮演）**

```markdown
# 角色设定
你现在扮演一位{{customer_persona}}的顾客，正在与店铺员工进行对话。

# 场景信息
- 场景：{{scenario}}
- 难度：{{difficulty}}
- 你的画像：{{persona_detail}}
- 你的目标：{{customer_goal}}
- 你的顾虑：{{concerns}}

# 店铺信息（你不知道，但员工应该能回答）
{{shop_context}}

# 扮演规则
1. 保持角色一致性，像真实顾客一样说话
2. 根据员工的回答决定你的态度变化
3. 如果员工处理得好，可以逐渐被说服
4. 如果员工处理不好，可以表现出不满或失去兴趣
5. 对话控制在 5-10 轮左右
6. 当场景自然结束时，在回复末尾加上 [对话结束]

# 难度控制
{{#if difficulty == 1}}
你是一个友好的顾客，比较容易沟通
{{/if}}
{{#if difficulty == 2}}
你有一些顾虑，需要员工用心解答
{{/if}}
{{#if difficulty == 3}}
你比较挑剔，会提出各种异议
{{/if}}
```

**系统提示词模板（评分）**

```markdown
# 角色设定
你是一位专业的销售培训教练，需要对员工的对话表现进行评分和反馈。

# 评分维度
1. **话术准确度** (25%)
   - 是否符合标准话术
   - 关键信息是否准确
   - 产品知识是否正确

2. **响应速度** (10%)
   - 回复是否及时
   - 有无长时间停顿
   
3. **情绪管理** (20%)
   - 面对刁难时的态度
   - 是否保持耐心友好
   - 同理心表达

4. **转化能力** (25%)
   - 是否成功引导客户
   - 推进销售进程的能力
   - 临门一脚的技巧

5. **知识掌握** (20%)
   - 产品知识运用
   - 价格政策理解
   - 服务流程熟悉度

# 标准话术参考
{{standard_scripts}}

# 评分输出格式
{
  "scores": {
    "accuracy": 85,
    "speed": 90,
    "emotion": 80,
    "conversion": 70,
    "knowledge": 75,
    "total": 78
  },
  "feedback": {
    "highlights": ["..."],
    "improvements": ["..."]
  },
  "detailedComments": [
    {
      "round": 1,
      "employeeMessage": "...",
      "comment": "...",
      "suggestion": "..."
    }
  ],
  "overallSuggestion": "..."
}
```

---

#### 7.6.11 违禁词检测

**调用流程**

```
输入文本 → 规则引擎匹配 → 命中则返回 → 未命中则调用LLM → 返回结果
              │                              │
         预置词库                       Qwen-Turbo
         (高效低成本)                    (兜底检测)
```

**规则引擎实现**

```typescript
// lib/services/forbidden-words.ts

// 预置违禁词库
const FORBIDDEN_WORDS = {
  // 广告法绝对化用语
  absolute: [
    '最', '第一', '顶级', '极致', '绝对', '100%', '永久', 
    '万能', '祖传', '特效', '无敌', '冠军', '独一无二'
  ],
  
  // 医疗相关
  medical: [
    '治疗', '治愈', '疗效', '药效', '康复', '根治',
    '特效药', '医治', '处方', '疾病'
  ],
  
  // 虚假承诺
  falsePromise: [
    '包治', '包好', '保证', '承诺', '一定', '肯定',
    '必须', '绝对有效'
  ],
  
  // 平台特定词（抖音）
  douyin: [
    '点击下方', '私信', '微信', '加我', '联系方式',
    '免费领取', '扫码'
  ],
  
  // 平台特定词（小红书）
  xiaohongshu: [
    '最便宜', '全网最低', '闺蜜价', '内部价',
    '买它', '必买', '无脑入'
  ]
}

interface ForbiddenCheckResult {
  hasForbidden: boolean
  matches: Array<{
    word: string
    category: string
    position: number
    context: string
    suggestion: string
  }>
}

function checkForbiddenWords(
  text: string, 
  platform: 'douyin' | 'xiaohongshu' | 'weixin' | 'general'
): ForbiddenCheckResult {
  const matches: ForbiddenCheckResult['matches'] = []
  
  // 获取适用的词库
  const wordLists = ['absolute', 'medical', 'falsePromise']
  if (platform === 'douyin') wordLists.push('douyin')
  if (platform === 'xiaohongshu') wordLists.push('xiaohongshu')
  
  // 遍历检测
  for (const category of wordLists) {
    for (const word of FORBIDDEN_WORDS[category]) {
      const regex = new RegExp(word, 'gi')
      let match
      while ((match = regex.exec(text)) !== null) {
        matches.push({
          word: match[0],
          category,
          position: match.index,
          context: text.slice(Math.max(0, match.index - 10), match.index + word.length + 10),
          suggestion: getSuggestion(word, category)
        })
      }
    }
  }
  
  return {
    hasForbidden: matches.length > 0,
    matches
  }
}

// 获取替换建议
function getSuggestion(word: string, category: string): string {
  const suggestions: Record<string, Record<string, string>> = {
    absolute: {
      '最': '非常/特别',
      '第一': '领先的/优质的',
      '100%': '高达/接近',
      '永久': '长期/持久'
    },
    medical: {
      '治疗': '调理/改善',
      '治愈': '好转/恢复',
      '疗效': '效果/作用'
    }
  }
  
  return suggestions[category]?.[word] || '建议删除或替换'
}
```

---

### 7.7 统一 AI 调度器实现

```typescript
// lib/ai/dispatcher.ts

import { MODEL_CONFIG, FEATURE_MODEL_MAP } from './config'
import { callAnthropic } from './providers/anthropic'
import { callTongyi } from './providers/tongyi'
import { callSiliconFlow } from './providers/siliconflow'
import { checkForbiddenWords } from '../services/forbidden-words'
import { calculateQualityScore } from '../services/quality-scorer'

export interface AIRequest {
  feature: string
  message: string
  attachments?: Attachment[]
  shopContext: ShopContext
  config?: {
    outputVersions?: number
    modelOverride?: string
    platform?: string
  }
}

export interface AIResponse {
  versions: ContentVersion[]
  qualityScore?: QualityScore
  forbiddenWords?: ForbiddenCheckResult
  usage: TokenUsage
}

export async function dispatchAI(request: AIRequest): Promise<AIResponse> {
  // 1. 确定模型等级
  const modelLevel = FEATURE_MODEL_MAP[request.feature] || 'medium'
  const modelConfig = request.config?.modelOverride 
    ? parseModelOverride(request.config.modelOverride)
    : MODEL_CONFIG.text[modelLevel]
  
  // 2. 预处理：图片分析
  let enrichedMessage = request.message
  if (request.attachments?.length > 0) {
    const imageAnalysis = await analyzeImages(request.attachments)
    enrichedMessage = `【图片分析】\n${imageAnalysis}\n\n【用户需求】\n${request.message}`
  }
  
  // 3. 构建系统提示词
  const systemPrompt = buildSystemPrompt(request.feature, request.shopContext)
  
  // 4. 调用 LLM
  let response: LLMResponse
  try {
    response = await callLLM(modelConfig, systemPrompt, enrichedMessage)
  } catch (error) {
    // 降级到备选模型
    console.log(`Primary model failed, falling back to: ${modelConfig.fallback.model}`)
    response = await callLLM(modelConfig.fallback, systemPrompt, enrichedMessage)
  }
  
  // 5. 解析多版本输出
  const versions = parseVersions(response.content, request.config?.outputVersions || 3)
  
  // 6. 后处理：违禁词检测
  const forbiddenResult = checkForbiddenWords(
    versions.map(v => v.content).join('\n'),
    request.config?.platform || 'general'
  )
  
  // 7. 后处理：质量评分
  const qualityScore = await calculateQualityScore(
    versions[0].content,
    request.feature
  )
  
  return {
    versions,
    qualityScore,
    forbiddenWords: forbiddenResult,
    usage: response.usage
  }
}

// 调用 LLM（统一接口）
async function callLLM(
  config: ModelConfig, 
  system: string, 
  user: string
): Promise<LLMResponse> {
  switch (config.provider) {
    case 'anthropic':
      return callAnthropic(config.model, system, user)
    case 'tongyi':
      return callTongyi(config.model, system, user)
    case 'siliconflow':
      return callSiliconFlow(config.model, system, user)
    default:
      throw new Error(`Unknown provider: ${config.provider}`)
  }
}

// 图片分析
async function analyzeImages(attachments: Attachment[]): Promise<string> {
  const visionConfig = MODEL_CONFIG.vision.primary
  
  const response = await callAnthropic(visionConfig.model, 
    '请分析这些图片的内容，提取关键信息，用于后续的内容创作。',
    attachments.map(a => ({
      type: 'image',
      source: { type: 'url', url: a.url }
    }))
  )
  
  return response.content
}
```

### 7.8 成本估算与优化

#### 7.8.1 单次调用成本估算

| 功能 | 主模型 | 预估输入 | 预估输出 | 单次成本 |
|------|--------|----------|----------|----------|
| 短视频脚本生成 | Claude Haiku | 1000 tokens | 2000 tokens | ¥0.02 |
| 小红书笔记生成 | Claude Haiku | 800 tokens | 1500 tokens | ¥0.015 |
| 爆款拆解 | Claude Sonnet | 2000 tokens | 3000 tokens | ¥0.25 |
| 文案改写 | Qwen-Turbo | 500 tokens | 1000 tokens | ¥0.003 |
| 朋友圈助手 | Claude Haiku | 800 tokens | 1000 tokens | ¥0.012 |
| 活动策划 | Claude Sonnet | 1500 tokens | 4000 tokens | ¥0.35 |
| 海报提示词 | Claude Haiku | 500 tokens | 300 tokens | ¥0.006 |
| 海报生成 | 即梦 | - | - | ¥0.1 |
| 智能问答 (RAG) | Claude Sonnet | 3000 tokens | 1000 tokens | ¥0.15 |
| AI 对练（单轮）| Claude Sonnet | 1500 tokens | 500 tokens | ¥0.08 |
| 对练评分 | Claude Sonnet | 3000 tokens | 1000 tokens | ¥0.15 |
| 违禁词检测 | 规则引擎 | - | - | ¥0 |

#### 7.8.2 月度成本预估（单店铺）

假设每天使用情况：
- 短视频脚本：2 次
- 小红书笔记：2 次
- 爆款拆解：1 次
- 文案改写：3 次
- 朋友圈助手：5 次
- 活动策划：0.1 次（3天1次）
- 海报制作：0.5 次
- 智能问答：5 次
- AI 对练：1 次（5轮）

| 功能 | 日均成本 | 月成本 |
|------|----------|--------|
| 短视频脚本 | ¥0.04 | ¥1.2 |
| 小红书笔记 | ¥0.03 | ¥0.9 |
| 爆款拆解 | ¥0.25 | ¥7.5 |
| 文案改写 | ¥0.009 | ¥0.27 |
| 朋友圈助手 | ¥0.06 | ¥1.8 |
| 活动策划 | ¥0.035 | ¥1.05 |
| 海报制作 | ¥0.053 | ¥1.6 |
| 智能问答 | ¥0.75 | ¥22.5 |
| AI 对练 | ¥0.55 | ¥16.5 |
| **合计** | **¥1.78** | **¥53.4** |

#### 7.8.3 成本优化策略

| 策略 | 说明 | 预估节省 |
|------|------|----------|
| **缓存热门问答** | 知识库高频问题缓存答案 | -30% RAG 成本 |
| **批量处理** | 一周朋友圈计划批量生成 | -20% 调用次数 |
| **模型降级** | 简单追问用 Haiku 而非 Sonnet | -40% 追问成本 |
| **本地规则优先** | 违禁词/简单改写用规则引擎 | -100% 这部分成本 |

---

## 8. 数据库设计

### 8.1 核心表结构

```sql
-- 用户表
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  username VARCHAR(50) NOT NULL,
  phone VARCHAR(20),
  avatar_url VARCHAR(500),
  role VARCHAR(20) DEFAULT 'member',  -- admin/member/viewer
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 店铺表（支持多店铺）
CREATE TABLE shops (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  owner_id UUID REFERENCES users(id),
  name VARCHAR(100) NOT NULL,
  industry VARCHAR(50) NOT NULL,
  address VARCHAR(255),
  description TEXT,
  target_customer TEXT,
  brand_style VARCHAR(50),
  slogan VARCHAR(255),
  contact_info JSONB,
  logo_url VARCHAR(500),
  settings JSONB,  -- 风格偏好等设置
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 店铺成员表
CREATE TABLE shop_members (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  shop_id UUID REFERENCES shops(id),
  user_id UUID REFERENCES users(id),
  role VARCHAR(20) NOT NULL,  -- admin/operator/staff
  permissions JSONB,
  joined_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(shop_id, user_id)
);

-- 对话表
CREATE TABLE conversations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  shop_id UUID REFERENCES shops(id),
  user_id UUID REFERENCES users(id),
  feature VARCHAR(50) NOT NULL,  -- 功能标识
  title VARCHAR(255),
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 消息表
CREATE TABLE messages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  conversation_id UUID REFERENCES conversations(id),
  role VARCHAR(20) NOT NULL,  -- user/assistant
  content TEXT NOT NULL,
  attachments JSONB,
  metadata JSONB,  -- 质量评分、警告等
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 知识库文档表
CREATE TABLE knowledge_documents (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  shop_id UUID REFERENCES shops(id),
  title VARCHAR(255) NOT NULL,
  content TEXT NOT NULL,
  category VARCHAR(50),
  tags VARCHAR(255)[],
  version INT DEFAULT 1,
  parent_id UUID REFERENCES knowledge_documents(id),  -- 版本关联
  source_type VARCHAR(50),  -- upload/chat/ai_generated
  created_by UUID REFERENCES users(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 知识库向量表（用于 RAG）
CREATE TABLE knowledge_embeddings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  document_id UUID REFERENCES knowledge_documents(id),
  chunk_index INT NOT NULL,
  chunk_text TEXT NOT NULL,
  embedding VECTOR(1536),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 素材库表
CREATE TABLE materials (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  shop_id UUID REFERENCES shops(id),
  user_id UUID REFERENCES users(id),
  type VARCHAR(50) NOT NULL,  -- image/text/template/case
  title VARCHAR(255),
  content TEXT,
  file_url VARCHAR(500),
  folder_id UUID,
  tags VARCHAR(255)[],
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 内容日历表
CREATE TABLE content_calendar (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  shop_id UUID REFERENCES shops(id),
  user_id UUID REFERENCES users(id),
  channel VARCHAR(50) NOT NULL,  -- douyin/xiaohongshu/moments/video_account
  scheduled_at TIMESTAMPTZ NOT NULL,
  content TEXT NOT NULL,
  attachments JSONB,
  status VARCHAR(20) DEFAULT 'draft',  -- draft/scheduled/published/cancelled
  conversation_id UUID REFERENCES conversations(id),  -- 关联来源对话
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 收藏表
CREATE TABLE favorites (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  message_id UUID REFERENCES messages(id),
  folder VARCHAR(100),
  note TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 培训学习进度表
CREATE TABLE learning_progress (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  shop_id UUID REFERENCES shops(id),
  stage VARCHAR(50) NOT NULL,  -- 学习阶段
  module_id VARCHAR(100) NOT NULL,  -- 学习模块
  status VARCHAR(20) DEFAULT 'not_started',  -- not_started/in_progress/completed
  score INT,  -- 考核分数
  completed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 对练记录表
CREATE TABLE roleplay_sessions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  shop_id UUID REFERENCES shops(id),
  scenario VARCHAR(100) NOT NULL,  -- 场景类型
  messages JSONB NOT NULL,  -- 对话记录
  score INT,
  score_details JSONB,  -- 各维度评分
  feedback TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 运营数据表
CREATE TABLE operation_data (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  shop_id UUID REFERENCES shops(id),
  date DATE NOT NULL,
  metrics JSONB NOT NULL,  -- 各项指标数据
  source VARCHAR(50) DEFAULT 'manual',  -- manual/import
  created_by UUID REFERENCES users(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(shop_id, date)
);

-- 使用量统计表
CREATE TABLE usage_stats (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  shop_id UUID REFERENCES shops(id),
  user_id UUID REFERENCES users(id),
  feature VARCHAR(50) NOT NULL,
  tokens_used INT DEFAULT 0,
  requests_count INT DEFAULT 0,
  date DATE NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(shop_id, user_id, feature, date)
);

-- 订阅表
CREATE TABLE subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  shop_id UUID REFERENCES shops(id),
  plan VARCHAR(50) NOT NULL,  -- free/pro/team
  status VARCHAR(20) DEFAULT 'active',
  current_period_start TIMESTAMPTZ,
  current_period_end TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 8.2 索引设计

```sql
-- 对话查询优化
CREATE INDEX idx_conversations_shop_user ON conversations(shop_id, user_id);
CREATE INDEX idx_conversations_feature ON conversations(feature);
CREATE INDEX idx_messages_conversation ON messages(conversation_id);

-- 知识库检索优化
CREATE INDEX idx_knowledge_shop_category ON knowledge_documents(shop_id, category);
CREATE INDEX idx_knowledge_embeddings_document ON knowledge_embeddings(document_id);

-- 向量相似度搜索（需要 pgvector 扩展）
CREATE INDEX idx_knowledge_embeddings_vector ON knowledge_embeddings 
  USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);

-- 内容日历查询优化
CREATE INDEX idx_calendar_shop_date ON content_calendar(shop_id, scheduled_at);
CREATE INDEX idx_calendar_status ON content_calendar(status);

-- 使用量统计优化
CREATE INDEX idx_usage_shop_date ON usage_stats(shop_id, date);
```

---

## 9. API 设计

### 9.1 API 概览

| 模块 | 端点 | 方法 | 描述 |
|------|------|------|------|
| **认证** | /api/auth/register | POST | 用户注册 |
| | /api/auth/login | POST | 用户登录 |
| | /api/auth/logout | POST | 退出登录 |
| **店铺** | /api/shops | GET/POST | 获取/创建店铺 |
| | /api/shops/:id | GET/PUT/DELETE | 店铺详情/更新/删除 |
| | /api/shops/:id/members | GET/POST | 店铺成员管理 |
| **AI 功能** | /api/ai/copywriting | POST | 文案生成 |
| | /api/ai/analyze | POST | 爆款拆解 |
| | /api/ai/rewrite | POST | 文案改写 |
| | /api/ai/moments | POST | 朋友圈助手 |
| | /api/ai/activity | POST | 活动策划 |
| | /api/ai/poster | POST | 海报制作 |
| | /api/ai/qa | POST | 知识库问答 |
| | /api/ai/roleplay | POST | AI 对练 |
| **知识库** | /api/knowledge | GET/POST | 知识文档列表/上传 |
| | /api/knowledge/:id | GET/PUT/DELETE | 文档详情/更新/删除 |
| | /api/knowledge/search | POST | 知识检索 |
| **素材库** | /api/materials | GET/POST | 素材列表/上传 |
| | /api/materials/:id | GET/DELETE | 素材详情/删除 |
| **内容日历** | /api/calendar | GET/POST | 日历内容列表/创建 |
| | /api/calendar/:id | PUT/DELETE | 更新/删除 |
| **数据分析** | /api/analytics/data | GET/POST | 运营数据查询/录入 |
| | /api/analytics/report | GET | 生成分析报告 |
| **培训** | /api/training/progress | GET/PUT | 学习进度 |
| | /api/training/quiz | GET/POST | 考核测试 |
| **历史收藏** | /api/conversations | GET | 对话历史 |
| | /api/favorites | GET/POST/DELETE | 收藏管理 |

### 9.2 核心 API 示例

#### 文案生成 API

```typescript
// POST /api/ai/copywriting

// 请求
interface CopywritingRequest {
  type: 'short_video' | 'xiaohongshu' | 'article' | 'title'
  topic: string
  images?: string[]  // 图片 URL 列表
  reference?: string  // 参考文案
  platform?: 'douyin' | 'xiaohongshu' | 'weixin'
  style?: 'professional' | 'friendly' | 'playful'
  outputVersions?: number  // 默认 3
}

// 响应
interface CopywritingResponse {
  success: boolean
  data: {
    versions: {
      id: string
      content: string
      qualityScore: number
      highlights: string[]  // 亮点
    }[]
    warnings?: {
      type: 'forbidden_word' | 'too_long' | 'too_short'
      message: string
      details?: any
    }[]
    suggestions?: string[]
  }
}
```

#### 知识库检索 API

```typescript
// POST /api/knowledge/search

// 请求
interface KnowledgeSearchRequest {
  query: string
  shopId: string
  topK?: number  // 默认 5
  category?: string
}

// 响应
interface KnowledgeSearchResponse {
  success: boolean
  data: {
    answer: string  // AI 生成的回答
    references: {
      documentId: string
      title: string
      excerpt: string
      score: number
    }[]
  }
}
```

---

## 10. 版本规划

### 10.1 MVP 范围（v1.0）

**目标**：验证产品概念，2-3 个月完成

**包含功能**：

| 优先级 | 功能 | 说明 |
|--------|------|------|
| P0 | 用户系统 | 注册/登录/多店铺/权限 |
| P0 | 店铺档案 | 基本信息设置 |
| P0 | 文案生成器 | 短视频脚本、小红书笔记 |
| P0 | 爆款拆解 | 上传文案/截图分析 |
| P0 | 文案改写 | 去重、风格转换 |
| P0 | 朋友圈助手 | 图片配文、多风格生成 |
| P0 | 知识库管理 | 上传文档、智能问答 |
| P1 | 活动策划 | 方案生成（快速版） |
| P1 | 海报制作 | 提示词生成 + AI 绘图 |
| P1 | 内容日历 | 基础排期功能 |
| P1 | 素材库 | 基础管理功能 |
| P1 | 历史收藏 | 基础功能 |

**暂不包含**：

- 运营数据分析（智能诊断、归因分析）
- 新员工培训（完整学习路径）
- AI 模拟对练
- 考核测试
- iOS App（先做小程序 + Web）

### 10.2 后续版本规划

**v1.1（+1 个月）**

- 运营数据分析（报表 + 趋势分析）
- 一周朋友圈计划
- 违禁词检测优化
- iOS App 基础版

**v1.2（+1 个月）**

- 新员工培训系统
- AI 模拟对练
- 考核测试
- 团队协作增强

**v2.0（+2 个月）**

- 运营数据智能诊断
- 归因分析
- 同行监控（可选）
- 更多 AI 能力扩展

---

## 11. 附录

### 11.1 订阅方案设计

| 版本 | 价格 | 功能范围 | 限制 |
|------|------|----------|------|
| **免费版** | 0 元 | 全功能可用 | 每功能每天 3 次 |
| **专业版** | 99 元/月 | 全功能无限次 | 1 店铺 / 2 账号 |
| **团队版** | 299 元/月 | 全功能无限次 + 培训系统 | 多店铺 / 10 账号 |

### 11.2 环境变量配置

```bash
# .env.local

# 数据库 (Supabase + pgvector)
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_key

# AI 文本模型
ANTHROPIC_API_KEY=your_anthropic_key      # Claude Sonnet/Haiku
TONGYI_API_KEY=your_tongyi_key            # Qwen-Max/Turbo + Embedding
SILICONFLOW_API_KEY=your_siliconflow_key  # GLM + Whisper

# AI 绘图模型
JIMENG_API_KEY=your_jimeng_key            # 即梦
# 通义万相使用 TONGYI_API_KEY

# 语音服务（备选）
XUNFEI_APP_ID=your_xunfei_appid
XUNFEI_API_KEY=your_xunfei_key
ALIYUN_ACCESS_KEY=your_aliyun_key

# 认证
JWT_SECRET=your_jwt_secret_at_least_32_chars

# 应用配置
NEXT_PUBLIC_APP_URL=https://your-domain.com
```

### 11.3 参考竞品

| 产品 | 定位 | 可借鉴点 |
|------|------|----------|
| 即创 | 抖音官方 AI 创作工具 | 视频脚本生成流程 |
| 小红书灵感中心 | 小红书官方 | 内容分析维度 |
| Jasper | 海外 AI 写作工具 | 多版本输出、模板系统 |
| Notion AI | 通用 AI 写作 | 内联编辑、追加指令 |
| 飞书知识库 | 团队知识管理 | 知识库组织方式 |

---

*产品名称：AI 掌柜*  
*文档版本：v2.0.0*  
*更新日期：2025-12-30*
