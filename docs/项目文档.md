# AI Skills Workbench é¡¹ç›®æ–‡æ¡£

> åŸºäº Next.js 14 + TypeScript + Supabase çš„ AI æŠ€èƒ½å¹³å°

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

AI Skills Workbench æ˜¯ä¸€ä¸ªä¼ä¸šçº§ AI æŠ€èƒ½ç®¡ç†å¹³å°ï¼Œè®©ç”¨æˆ·å¯ä»¥ï¼š
- ä½¿ç”¨é¢„è®¾çš„ AI æŠ€èƒ½ï¼ˆæœ‹å‹åœˆæ–‡æ¡ˆã€è§†é¢‘æ”¹å†™ã€ä¼šè®®çºªè¦ç­‰ï¼‰
- åˆ›å»ºå’Œç®¡ç†è‡ªå®šä¹‰æŠ€èƒ½
- å¤šè½®å¯¹è¯äº¤äº’
- å†å²è®°å½•å’Œæ”¶è—ç®¡ç†

### 1.2 æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ |
|------|------|
| å‰ç«¯æ¡†æ¶ | Next.js 14 (App Router) |
| å¼€å‘è¯­è¨€ | TypeScript |
| UI ç»„ä»¶ | shadcn/ui + Tailwind CSS |
| æ•°æ®åº“ | Supabase (PostgreSQL) |
| AI æ¨¡å‹ | Claude API (Anthropic) |
| è®¤è¯æ–¹å¼ | JWT Token + Cookie |
| åŒ…ç®¡ç†å™¨ | npm |

### 1.3 é¡¹ç›®ç»“æ„

```
ai-skills-workbench/
â”œâ”€â”€ app/                    # Next.js é¡µé¢å’Œ API
â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth/          # è®¤è¯æ¥å£
â”‚   â”‚   â”œâ”€â”€ users/         # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ skills/        # æŠ€èƒ½æ¥å£
â”‚   â”‚   â”œâ”€â”€ claude/        # AI èŠå¤©
â”‚   â”‚   â”œâ”€â”€ history/       # å†å²è®°å½•
â”‚   â”‚   â””â”€â”€ favorites/     # æ”¶è—
â”‚   â”œâ”€â”€ admin/             # ç®¡ç†åå°
â”‚   â”œâ”€â”€ login/             # ç™»å½•é¡µ
â”‚   â”œâ”€â”€ skill/[id]/        # æŠ€èƒ½è¯¦æƒ…é¡µ
â”‚   â””â”€â”€ my-skills/         # æˆ‘çš„æŠ€èƒ½
â”œâ”€â”€ components/            # React ç»„ä»¶
â”œâ”€â”€ contexts/              # React Context
â”œâ”€â”€ lib/                   # å·¥å…·åº“
â”‚   â”œâ”€â”€ db/               # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ models/           # AI æ¨¡å‹é›†æˆ
â”‚   â””â”€â”€ skills/           # æŠ€èƒ½è§£æ
â”œâ”€â”€ public/               # é™æ€èµ„æº
â”‚   â””â”€â”€ skills/           # é¢„è®¾æŠ€èƒ½æ–‡ä»¶
â”œâ”€â”€ supabase/             # æ•°æ®åº“è„šæœ¬
â”‚   â”œâ”€â”€ schema.sql        # å®Œæ•´è¡¨ç»“æ„
â”‚   â””â”€â”€ migrations/       # è¿ç§»è„šæœ¬
â””â”€â”€ types/                # TypeScript ç±»å‹
```

---

## äºŒã€åŠŸèƒ½æ¨¡å—

### 2.1 ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

**ç™»å½•æ–¹å¼**ï¼šç”¨æˆ·å + å¯†ç 

**ç”¨æˆ·è§’è‰²**ï¼š
| è§’è‰² | æƒé™ |
|------|------|
| admin | ç®¡ç†å‘˜ï¼Œå¯ç®¡ç†æ‰€æœ‰ç”¨æˆ·å’ŒæŠ€èƒ½ |
| member | æˆå‘˜ï¼Œå¯ä½¿ç”¨æŠ€èƒ½å’Œåˆ›å»ºè‡ªå®šä¹‰æŠ€èƒ½ |
| viewer | è®¿å®¢ï¼Œåªèƒ½æŸ¥çœ‹å’Œä½¿ç”¨å…¬å¼€æŠ€èƒ½ |

**é»˜è®¤ç®¡ç†å‘˜è´¦å·**ï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

### 2.2 æŠ€èƒ½ç³»ç»Ÿ

**é¢„è®¾æŠ€èƒ½ï¼ˆ7ä¸ªï¼‰**ï¼š

| æŠ€èƒ½åç§° | åŠŸèƒ½è¯´æ˜ | è¾“å…¥ç±»å‹ |
|---------|---------|---------|
| æœ‹å‹åœˆæ–‡æ¡ˆ | ç”Ÿæˆæœ‰æ„ŸæŸ“åŠ›çš„æœ‹å‹åœˆæ–‡æ¡ˆ | æ–‡å­—/è¯­éŸ³/å›¾ç‰‡ |
| è§†é¢‘æ–‡æ¡ˆæ”¹å†™ | æŠŠè§†é¢‘å†…å®¹æ”¹å†™æˆé€‚åˆä¸åŒå¹³å°çš„æ–‡æ¡ˆ | æ–‡å­—/è¯­éŸ³ |
| çˆ†æ¬¾æ‹†è§£ | åˆ†æçˆ†æ¬¾å†…å®¹çš„ç»“æ„å’Œå¯å¤ç”¨å…ƒç´  | æ–‡å­—/å›¾ç‰‡ |
| ä¼šè®®è¯­éŸ³è½¬æ–‡å­— | è¯­éŸ³è½¬æ–‡å­—å¹¶æ•´ç†æˆä¼šè®®çºªè¦ | è¯­éŸ³ |
| çŸ¥è¯†åº“æŸ¥è¯¢ | ä»çŸ¥è¯†åº“æ£€ç´¢ç­”æ¡ˆï¼Œæ”¯æŒè¿½é—® | æ–‡å­—/è¯­éŸ³ |
| å®˜æ–¹é€šçŸ¥ | ç”Ÿæˆæ­£å¼é€šçŸ¥ã€å…¬å‘Šæ–‡æ¡ˆ | æ–‡å­— |
| æµ·æŠ¥åˆ¶ä½œ | ç”Ÿæˆæµ·æŠ¥è®¾è®¡æ–¹æ¡ˆå’Œæç¤ºè¯ | æ–‡å­—/å›¾ç‰‡ |

**æŠ€èƒ½æ–‡ä»¶æ ¼å¼**ï¼ˆSKILL.mdï¼‰ï¼š
```markdown
---
name: æŠ€èƒ½åç§°
description: æŠ€èƒ½æè¿°
icon: MessageCircle
category: æ–‡æ¡ˆåˆ›ä½œ
inputTypes: [text, voice, image]
placeholder: è¾“å…¥æç¤º...
---

# è§’è‰²è®¾å®š
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„...

# å·¥ä½œæµç¨‹
1. åˆ†æç”¨æˆ·è¾“å…¥
2. ç”Ÿæˆå†…å®¹
...
```

### 2.3 å¯¹è¯ç³»ç»Ÿ

- å¤šè½®å¯¹è¯æ”¯æŒ
- æ¶ˆæ¯æ”¶è—åŠŸèƒ½
- å¤åˆ¶/é‡æ–°ç”Ÿæˆ
- å†å²è®°å½•ä¿å­˜
- è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯

### 2.4 ç”¨æˆ·ç®¡ç†ï¼ˆç®¡ç†å‘˜ï¼‰

- åˆ›å»ºç”¨æˆ·ï¼ˆè®¾ç½®ç”¨æˆ·åã€å¯†ç ã€è§’è‰²ï¼‰
- ä¿®æ”¹ç”¨æˆ·è§’è‰²
- é‡ç½®ç”¨æˆ·å¯†ç 
- å¯ç”¨/ç¦ç”¨è´¦æˆ·
- åˆ é™¤ç”¨æˆ·

---

## ä¸‰ã€API æ¥å£æ–‡æ¡£

### 3.1 è®¤è¯æ¥å£

#### ç™»å½•
```
POST /api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}

Response:
{
  "success": true,
  "user": {
    "id": "uuid",
    "username": "admin",
    "name": "ç³»ç»Ÿç®¡ç†å‘˜",
    "role": "admin"
  }
}
```

#### è·å–å½“å‰ç”¨æˆ·
```
GET /api/auth/me

Response:
{
  "user": {
    "id": "uuid",
    "username": "admin",
    "email": "admin@system.local",
    "name": "ç³»ç»Ÿç®¡ç†å‘˜",
    "role": "admin"
  }
}
```

#### ç™»å‡º
```
POST /api/auth/logout

Response:
{
  "success": true,
  "message": "å·²é€€å‡ºç™»å½•"
}
```

### 3.2 ç”¨æˆ·æ¥å£ï¼ˆéœ€ç®¡ç†å‘˜æƒé™ï¼‰

#### è·å–ç”¨æˆ·åˆ—è¡¨
```
GET /api/users?page=1&limit=20&role=member

Response:
{
  "users": [...],
  "total": 10,
  "page": 1,
  "limit": 20,
  "totalPages": 1
}
```

#### åˆ›å»ºç”¨æˆ·
```
POST /api/users
Content-Type: application/json

{
  "username": "newuser",
  "email": "user@example.com",
  "password": "password123",
  "name": "æ–°ç”¨æˆ·",
  "role": "member"
}
```

#### æ›´æ–°ç”¨æˆ·
```
PATCH /api/users/{id}
Content-Type: application/json

{
  "name": "æ–°åç§°",
  "role": "admin",
  "password": "newpassword",
  "isActive": true
}
```

#### åˆ é™¤ç”¨æˆ·
```
DELETE /api/users/{id}
```

### 3.3 æŠ€èƒ½æ¥å£

#### è·å–æŠ€èƒ½åˆ—è¡¨
```
GET /api/skills

Response:
{
  "skills": [
    {
      "id": "moments-copywriter",
      "name": "æœ‹å‹åœˆæ–‡æ¡ˆ",
      "description": "...",
      "icon": "MessageCircle",
      "category": "æ–‡æ¡ˆåˆ›ä½œ",
      "inputTypes": ["text", "voice", "image"],
      "source": "official"
    }
  ]
}
```

#### è·å–æŠ€èƒ½è¯¦æƒ…
```
GET /api/skills/{id}

Response:
{
  "skill": {
    "id": "moments-copywriter",
    "name": "æœ‹å‹åœˆæ–‡æ¡ˆ",
    "content": "å®Œæ•´çš„ Prompt å†…å®¹...",
    ...
  }
}
```

### 3.4 èŠå¤©æ¥å£

```
POST /api/claude/chat
Content-Type: application/json

{
  "skillId": "moments-copywriter",
  "messages": [
    { "role": "user", "content": "å¸®æˆ‘å†™ä¸€æ¡å…³äºå¥èº«çš„æœ‹å‹åœˆ" }
  ]
}

Response:
{
  "content": "AI ç”Ÿæˆçš„å›å¤å†…å®¹...",
  "usage": {
    "input_tokens": 100,
    "output_tokens": 200
  }
}
```

---

## å››ã€æ•°æ®åº“è®¾è®¡

### 4.1 ç”¨æˆ·è¡¨ (users)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| email | VARCHAR(255) | é‚®ç®±ï¼Œå”¯ä¸€ |
| username | VARCHAR(50) | ç”¨æˆ·åï¼Œå”¯ä¸€ |
| password_hash | VARCHAR(255) | å¯†ç å“ˆå¸Œ |
| name | VARCHAR(100) | æ˜¾ç¤ºåç§° |
| role | VARCHAR(20) | è§’è‰²ï¼šadmin/member/viewer |
| is_active | BOOLEAN | æ˜¯å¦å¯ç”¨ |
| last_login_at | TIMESTAMPTZ | æœ€åç™»å½•æ—¶é—´ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | æ›´æ–°æ—¶é—´ |

### 4.2 æŠ€èƒ½è¡¨ (skills)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| name | VARCHAR(255) | æŠ€èƒ½åç§° |
| description | TEXT | æè¿° |
| icon | VARCHAR(100) | å›¾æ ‡åç§° |
| category | VARCHAR(100) | åˆ†ç±» |
| input_types | TEXT[] | è¾“å…¥ç±»å‹æ•°ç»„ |
| source | VARCHAR(20) | æ¥æºï¼šofficial/custom/community |
| owner_id | UUID | åˆ›å»ºè€… ID |
| content | TEXT | Prompt å†…å®¹ |
| is_public | BOOLEAN | æ˜¯å¦å…¬å¼€ |
| usage_count | INTEGER | ä½¿ç”¨æ¬¡æ•° |
| rating | DECIMAL(3,2) | è¯„åˆ† |

### 4.3 å¯¹è¯è¡¨ (conversations)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| user_id | UUID | ç”¨æˆ· ID |
| skill_id | UUID | æŠ€èƒ½ ID |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | æ›´æ–°æ—¶é—´ |

### 4.4 æ¶ˆæ¯è¡¨ (messages)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| conversation_id | UUID | å¯¹è¯ ID |
| role | VARCHAR(20) | è§’è‰²ï¼šuser/assistant |
| content | TEXT | æ¶ˆæ¯å†…å®¹ |
| attachments | JSONB | é™„ä»¶ä¿¡æ¯ |
| token_count | INTEGER | Token æ•°é‡ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |

---

## äº”ã€ç¯å¢ƒé…ç½®

### 5.1 ç¯å¢ƒå˜é‡ (.env.local)

```bash
# Supabase é…ç½®ï¼ˆå¿…éœ€ï¼‰
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJxxx...
SUPABASE_SERVICE_ROLE_KEY=eyJxxx...

# Claude APIï¼ˆå¿…éœ€ï¼‰
ANTHROPIC_API_KEY=sk-ant-api03-xxx

# JWT å¯†é’¥ï¼ˆå¯é€‰ï¼Œæœ‰é»˜è®¤å€¼ï¼‰
JWT_SECRET=your-secret-key

# Google Geminiï¼ˆå¯é€‰ï¼‰
GOOGLE_API_KEY=AIzaSy...

# è®¯é£è¯­éŸ³è¯†åˆ«ï¼ˆå¯é€‰ï¼‰
IFLYTEK_APP_ID=xxx
IFLYTEK_API_KEY=xxx
IFLYTEK_API_SECRET=xxx
```

### 5.2 æœ¬åœ°å¼€å‘

```bash
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—®
http://localhost:3000
```

### 5.3 æ•°æ®åº“åˆå§‹åŒ–

åœ¨ Supabase SQL Editor ä¸­ä¾æ¬¡æ‰§è¡Œï¼š

1. `supabase/schema.sql` - åˆ›å»ºè¡¨ç»“æ„
2. `supabase/migrations/20241224_create_users_table.sql` - ç”¨æˆ·è¡¨
3. `supabase/migrations/20241224_update_users_with_auth.sql` - è®¤è¯å­—æ®µ

---

## å…­ã€åŠŸèƒ½å¼€å‘è¿›åº¦

### 6.1 å·²å®Œæˆ âœ…

- [x] ç”¨æˆ·ç™»å½•/ç™»å‡º/æƒé™ç®¡ç†
- [x] æŠ€èƒ½å¹¿åœºå±•ç¤ºå’Œæœç´¢
- [x] æŠ€èƒ½åˆ†ç±»è¿‡æ»¤
- [x] å¤šè½®å¯¹è¯ç•Œé¢
- [x] å†å²è®°å½•ç®¡ç†
- [x] æ¶ˆæ¯æ”¶è—åŠŸèƒ½
- [x] ç”¨æˆ·ç®¡ç†åå°ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- [x] 7 ä¸ªé¢„è®¾æŠ€èƒ½
- [x] æ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢
- [x] å“åº”å¼è®¾è®¡

### 6.2 å¾…å¼€å‘ ğŸ“‹

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|-------|------|
| è¯­éŸ³è¾“å…¥ | é«˜ | é›†æˆè®¯é£è¯­éŸ³è¯†åˆ« |
| å›¾ç‰‡ä¸Šä¼  | é«˜ | æ”¯æŒå›¾ç‰‡é™„ä»¶å¤„ç† |
| æŠ€èƒ½ä¸Šä¼  API | é«˜ | ä¿å­˜è‡ªå®šä¹‰æŠ€èƒ½åˆ°æ•°æ®åº“ |
| æ–‡æ¡£é¡µé¢ | ä¸­ | ä½¿ç”¨è¯´æ˜å’Œå¸®åŠ©æ–‡æ¡£ |
| ZIP æŠ€èƒ½åŒ… | ä¸­ | æ‰¹é‡ä¸Šä¼ æŠ€èƒ½ |
| ç”¨æˆ·æ³¨å†Œ | ä¸­ | è‡ªåŠ©æ³¨å†ŒåŠŸèƒ½ |
| æŠ€èƒ½è¯„åˆ† | ä½ | ç”¨æˆ·è¯„ä»·ç³»ç»Ÿ |
| ä½¿ç”¨ç»Ÿè®¡ | ä½ | æ•°æ®åˆ†æä»ªè¡¨æ¿ |

---

## ä¸ƒã€å¸¸è§é—®é¢˜

### Q1: ç™»å½•æ˜¾ç¤º"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"

æ£€æŸ¥æ•°æ®åº“ä¸­ admin ç”¨æˆ·çš„ `password_hash` å­—æ®µæ˜¯å¦æ­£ç¡®ï¼š
```sql
UPDATE users
SET password_hash = '$2b$10$aIFuUXWoJEq..7bQT3dTVu8WOw4WS.rXn64g8bl5oNkmcBV2bxply'
WHERE username = 'admin';
```

### Q2: API è¿”å› 503 é”™è¯¯

æ£€æŸ¥ `.env.local` ä¸­æ˜¯å¦é…ç½®äº† `SUPABASE_SERVICE_ROLE_KEY`ã€‚

### Q3: AI å›å¤æ˜¯æ¨¡æ‹Ÿå†…å®¹

æ£€æŸ¥ `.env.local` ä¸­æ˜¯å¦é…ç½®äº† `ANTHROPIC_API_KEY`ã€‚æœªé…ç½®æ—¶ä¼šè¿”å› Mock å“åº”ã€‚

### Q4: é¡µé¢æ ·å¼é”™ä¹±

1. æ¸…ç†ç¼“å­˜ï¼š`rm -rf .next`
2. é‡å¯æœåŠ¡ï¼š`npm run dev`
3. ç¡®ä¿è®¿é—®æ­£ç¡®ç«¯å£ï¼ˆé»˜è®¤ 3000ï¼‰

---

## å…«ã€è”ç³»ä¸æ”¯æŒ

- é¡¹ç›®åœ°å€ï¼š`/Users/wanghui/DJ - AIå·¥å…·ç®±/ai-skills-workbench`
- å¼€å‘æ¡†æ¶ï¼šNext.js 14.2.4
- Node.js ç‰ˆæœ¬ï¼šå»ºè®® 18+

---

*æ–‡æ¡£æ›´æ–°æ—¶é—´ï¼š2024å¹´12æœˆ24æ—¥*
